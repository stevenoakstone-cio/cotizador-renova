---
phase: 05-banos
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [BANO-01, BANO-02, BANO-03]

must_haves:
  truths:
    - "bajoLavabo module exists in MODS with forType bano and correct width options"
    - "cajoneraBano module exists in MODS with forType bano and correct width options"
    - "botiquin module exists in MODS with forType bano and correct width/depth options"
    - "calculateParts() generates correct despiece for all 3 bano module types"
    - "assignHardware() assigns correct hardware for all 3 bano module types"
    - "HW_DEFAULTS contains soporte_bano key for wall-mount hardware"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "3 bano MODS entries, calculateParts blocks, assignHardware blocks, HW_DEFAULTS"
      contains: "bajoLavabo"
  key_links:
    - from: "MODS.bajoLavabo"
      to: "calculateParts()"
      via: "moduleType === 'bajoLavabo' branch"
      pattern: "moduleType === 'bajoLavabo'"
    - from: "MODS.cajoneraBano"
      to: "calculateParts()"
      via: "moduleType === 'cajoneraBano' branch"
      pattern: "moduleType === 'cajoneraBano'"
    - from: "MODS.botiquin"
      to: "calculateParts()"
      via: "moduleType === 'botiquin' branch"
      pattern: "moduleType === 'botiquin'"
    - from: "assignHardware()"
      to: "HW_DEFAULTS.soporte_bano"
      via: "hw.push for bajoLavabo and botiquin"
      pattern: "soporte_bano"
---

<objective>
Add 3 bathroom module types (bajoLavabo, cajoneraBano, botiquin) to MODS with calculateParts() despiece logic, assignHardware() hardware assignments, and HW_DEFAULTS entries.

Purpose: Establishes the data layer for bathroom vanity quoting -- dimensions, piece formulas, and hardware rules per INSTRUCTIVO_TECNICO Section 4.
Output: 3 MODS entries with forType:['bano'], corresponding calculateParts() and assignHardware() branches, new HW_DEFAULTS key for wall-mount brackets.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-cocina-extras-ui-output/04-01-SUMMARY.md
@INSTRUCTIVO_TECNICO.md (Section 4 — Muebles de Bano)
@CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 3 bano MODS entries + HW_DEFAULTS soporte_bano + calculateParts() blocks</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**1. Add HW_DEFAULTS entry** (after soporte_alacena line, ~line 3418):
```javascript
if (!HW_DEFAULTS.soporte_bano) HW_DEFAULTS.soporte_bano = { desc: 'Escuadra muro bano flotante', marca: 'DEMO', fallback: 35, cat: 'ACC. BANO' };
```

**2. Add 3 MODS entries** (after the last cocina Extras entry, before puerta entry). All use `forType: ['bano']`:

```javascript
// Bano modules — Material: MDF RH obligatorio | Prof: 45-50cm, Alto: 50-60cm
bajoLavabo: {
    n: 'Bajo Lavabo',
    w: [60, 75, 80, 90, 100],
    d: 'Cajon con saque U para cespol | MDF RH | Prof: 45-50cm',
    forType: ['bano'],
    cat: 'Bajos'
},
cajoneraBano: {
    n: 'Cajonera Bano',
    w: [40, 45, 50, 60],
    d: '2-3 cajones auxiliar | MDF RH | Alto: 50-60cm',
    forType: ['bano'],
    cat: 'Bajos'
},
botiquin: {
    n: 'Botiquin / Espejo',
    w: [40, 50, 60, 80],
    d: 'Modulo pared delgado 10-15cm prof | MDF RH',
    forType: ['bano'],
    cat: 'Altos'
},
```

**3. Add calculateParts() blocks** inside the function, after the last cocina extras block (after cubierta), before the closing return:

**bajoLavabo** (per INSTRUCTIVO 4.2):
- Standard bano bajo: h=500-600mm (use h param), d=450-500mm (use d param)
- Casco pieces: 2 costados (h x d), 1 piso (iW x d), 1 techo/amarre (iW x 80mm), 1 fondo HDF (iW x h, t:3)
- Cajon superior WITH saque en U: costados (cajH x (d-80)), frente interno (iW - 26mm x cajH), fondo HDF (iW-26 x d-80, t:3)
- Saque en U dimensions: 220mm wide x 180mm deep, centered — this is a NOTE on the cajon, not a separate piece. Add `saqueU: true` flag to the cajon frente interno piece for documentation.
- cajH = Math.round((h - 2*TK) / 2) for 2-cajón layout (top cajón with saque, bottom cajón without)
- Bottom cajon: same pieces as top but WITHOUT saqueU flag
- Frente pieces (z:'f'): 2 frentes de cajon (iW - 4mm x cajH - 5mm each)
- Use `var cajCount = materials.cajones || 2;` to allow 1-2 cajones (default 2)
- When cajCount === 1: single cajón occupying full inner height minus TK for amarre

**cajoneraBano** (per INSTRUCTIVO 4.2 — auxiliary module):
- Same structure as cocina cajonera but shorter (h=500-600mm range)
- Casco: 2 costados (h x d), 1 piso (iW x d), 1 amarre sup (iW x 80mm), 1 fondo HDF (iW x h, t:3)
- cajCount from `materials.cajones || 2` (allow 2-3)
- Per-cajon pieces: 2 costados cajon, 1 frente interno, 1 fondo cajon HDF
- cajH formula: `Math.round((h - TK) / cajCount)` (minus TK for top amarre only — no techo)
- Cajon costados: cajH x (d - 80mm)
- Cajon frente interno: (iW - 26mm) x cajH // AUDIT: -26mm = 13mm per side for Blum Tandem clip
- Cajon fondo: (iW - 26mm) x (d - 80mm), t:3
- Frentes (z:'f'): cajCount pieces, each (iW - 4mm) x (cajH - 5mm)

**botiquin** (per INSTRUCTIVO 4.2):
- Thin wall-mount module: d=100-150mm (use d param), h=600-900mm (use h param)
- Casco: 2 costados (h x d), 1 piso (iW x d), 1 techo (iW x d), 1 fondo HDF (iW x h, t:3)
- 1 entrepaño: (iW - 30mm) x (d - 15mm) // adjustable shelf
- Frente (z:'f'): 1 puerta when w <= 500mm, 2 puertas when w > 500mm
  - 1 puerta: (iW - 4mm) x (h - 10mm)
  - 2 puertas: ((iW/2) - 2mm) x (h - 10mm)

All pieces use `z: 'i'` for casco material, `z: 'f'` for frente material (matching existing pattern). Use `// AUDIT:` prefix on dimension comments.
  </action>
  <verify>
Search for these strings in the file:
- `bajoLavabo:` in MODS section
- `cajoneraBano:` in MODS section
- `botiquin:` in MODS section
- `moduleType === 'bajoLavabo'` in calculateParts()
- `moduleType === 'cajoneraBano'` in calculateParts()
- `moduleType === 'botiquin'` in calculateParts()
- `soporte_bano` in HW_DEFAULTS
- `forType: ['bano']` appears 3 times
  </verify>
  <done>3 MODS entries exist with forType:['bano']. calculateParts() returns correct pieces for each type with AUDIT comments on dimension formulas. HW_DEFAULTS.soporte_bano exists.</done>
</task>

<task type="auto">
  <name>Task 2: Add assignHardware() blocks for 3 bano module types</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add `else if` branches in assignHardware() for the 3 bano types. Place them after the last cocina extras block (cubierta), before any closing else.

**bajoLavabo:**
```javascript
} else if (moduleType === 'bajoLavabo') {
    // Bano: bajo lavabo flotante — Blum Tandem per cajon + wall-mount brackets
    var cajCount = options.cajones || 2;
    for (var ci = 0; ci < cajCount; ci++) {
        hw.push({ key: 'corr_tandem', q: 1 });
    }
    hw.push({ key: 'soporte_bano', q: 2 });
```

**cajoneraBano:**
```javascript
} else if (moduleType === 'cajoneraBano') {
    // Bano: cajonera auxiliar — Blum Tandem per cajon + wall-mount brackets (flotante)
    var cajCount = options.cajones || 2;
    for (var ci = 0; ci < cajCount; ci++) {
        hw.push({ key: 'corr_tandem', q: 1 });
    }
    hw.push({ key: 'soporte_bano', q: 2 });
```

**botiquin:**
```javascript
} else if (moduleType === 'botiquin') {
    // Bano: botiquin/espejo — wall-mount brackets only, bisagras handled in calc() door block
    hw.push({ key: 'soporte_bano', q: 2 });
```

Note: Bisagras for botiquin puertas are handled by the calc() door block (same pattern as alacenaEstandar). The assignHardware() only handles non-door hardware.

No patas for any bano module — all are wall-mounted (flotante) per INSTRUCTIVO 4.3.
No zoclo_clip for bano — no zoclo on floating modules.
  </action>
  <verify>
Search for:
- `moduleType === 'bajoLavabo'` in assignHardware()
- `moduleType === 'cajoneraBano'` in assignHardware()
- `moduleType === 'botiquin'` in assignHardware()
- `soporte_bano` appears in all 3 assignHardware blocks
- `corr_tandem` appears in bajoLavabo and cajoneraBano blocks
  </verify>
  <done>assignHardware() returns correct hardware for all 3 bano types: Tandem correderas per cajon for bajoLavabo and cajoneraBano, wall-mount brackets for all 3, no patas or zoclo clips.</done>
</task>

</tasks>

<verification>
1. `bajoLavabo`, `cajoneraBano`, `botiquin` exist in MODS with `forType: ['bano']`
2. calculateParts() has branches for all 3 types producing pieces with correct z flags
3. assignHardware() has branches for all 3 types
4. HW_DEFAULTS.soporte_bano exists
5. bajoLavabo pieces include saqueU flag on top cajon
6. botiquin pieces include 1/2 puertas based on width threshold
7. No patas or zoclo_clip for any bano module
</verification>

<success_criteria>
All 3 bano module types defined in MODS with calculateParts() and assignHardware() branches producing correct despiece and hardware per INSTRUCTIVO Section 4. Wall-mount hardware (soporte_bano) assigned to all bano modules. No door generation in calc() for bajoLavabo/cajoneraBano (frentes handled in calculateParts as cajon frentes).
</success_criteria>

<output>
After completion, create `.planning/phases/05-banos/05-01-SUMMARY.md`
</output>
