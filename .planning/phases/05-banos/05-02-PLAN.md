---
phase: 05-banos
plan: "02"
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [BANO-04, BANO-05]

must_haves:
  truths:
    - "User can select Bano as project type in Step 1 wizard"
    - "When type is bano, step2() shows only bano modules grouped by category (Bajos, Altos)"
    - "Selecting any non-MDF-RH material for ANY bano module shows a red blocking warning"
    - "calc() door block correctly handles botiquin (generates puertas) and skips bajoLavabo/cajoneraBano (frentes in calculateParts)"
    - "cajones selector appears for bajoLavabo (1-2) and cajoneraBano (2-3) in step2()"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "bano TYPES entry, calc() door logic, MDF-RH validation, cajones selector"
      contains: "id: 'bano'"
  key_links:
    - from: "TYPES"
      to: "step1() project type selector"
      via: "bano entry in TYPES array"
      pattern: "id: 'bano'"
    - from: "step2() filter"
      to: "MODS forType"
      via: "existing forType filter matching P.type === 'bano'"
      pattern: "forType.*bano"
    - from: "step2() validation"
      to: "MDF-RH check"
      via: "isRH check extended to all bano module types"
      pattern: "m\\.type === 'bajoLavabo' \\|\\| m\\.type === 'cajoneraBano' \\|\\| m\\.type === 'botiquin'"
    - from: "calc() door block"
      to: "botiquin puertas"
      via: "botiquin follows alacenaEstandar puerta pattern"
      pattern: "m\\.type === 'botiquin'"
---

<objective>
Wire bano modules into the UI: add 'bano' project type, extend calc() door logic for bano types, add MDF-RH validation for ALL bano modules, and add cajones selector for bajoLavabo and cajoneraBano.

Purpose: Completes the bano workflow so users can create a bathroom vanity project end-to-end with correct validation.
Output: Bano selectable as project type, modules filtered correctly, MDF-RH enforced, cajones configurable.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-banos/05-01-SUMMARY.md
@.planning/phases/04-cocina-extras-ui-output/04-02-SUMMARY.md
@INSTRUCTIVO_TECNICO.md (Section 4 — Muebles de Bano)
@CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bano to TYPES + calc() door logic + door skip guard for bano cajón types</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**1. Add 'bano' to TYPES array** (after cocina entry, before puerta):
```javascript
}, {
    id: 'bano',
    n: 'Bano',
    i: '&#x1f6bf;'  // shower emoji
}, {
```

**2. Update calc() door skip guard** to include bajoLavabo and cajoneraBano (their frentes are cajón frentes generated in calculateParts(), same as cocina cajonera pattern):

Find the door skip guard (currently includes `cajonera || hornoBase || torreHornos || zoclo || vistaLateral || panelRelleno || cubierta`) and ADD `|| m.type === 'bajoLavabo' || m.type === 'cajoneraBano'` to the skip condition.

**3. Add botiquin to calc() door block** — botiquin has puertas (like alacenaEstandar). Inside the `else` branch of the door block (where puerta widths are computed), add a condition for botiquin:

After the existing `bajoEstandar` width check, add:
```javascript
} else if (m.type === 'botiquin') {
    // AUDIT: botiquin 1 puerta if <=500mm, 2 puertas if >500mm (same as bajoEstandar pattern)
    doorCnt = m.width <= 50 ? 1 : 2;
```

This ensures botiquin gets bisagras via the existing bisagra count logic in the door block.

**4. Add bisKey mapping** — botiquin uses standard `bisagra` (not bisagra_165). Confirm no special bisKey needed; the default bisKey path handles it.
  </action>
  <verify>
Search for:
- `id: 'bano'` in TYPES array
- `bajoLavabo` and `cajoneraBano` in door skip guard
- `m.type === 'botiquin'` in door block with doorCnt logic
- botiquin NOT in door skip guard (it SHOULD generate puertas)
  </verify>
  <done>Bano appears in TYPES. calc() correctly skips door generation for bajoLavabo/cajoneraBano (cajón frentes from calculateParts). calc() generates puertas for botiquin with 1/2 door auto-selection by width. Botiquin gets bisagras via standard door block.</done>
</task>

<task type="auto">
  <name>Task 2: MDF-RH validation for ALL bano modules + cajones selector in step2()</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**1. Extend MDF-RH validation to all bano modules:**

Currently, the fregadero MDF-RH check in step2() (around line 7459) triggers only for `m.type === 'fregadero'`. Modify this condition to also trigger for ALL bano module types:

Change:
```javascript
if (m.type === 'fregadero') {
```
To:
```javascript
if (m.type === 'fregadero' || m.type === 'bajoLavabo' || m.type === 'cajoneraBano' || m.type === 'botiquin') {
```

This reuses the exact same isRH check logic (checks both matInterior and matFrentes for "RH" or "RESISTENTE" strings) and shows the same red warning div. The warning text already says "Zona humeda — usar MDF RH (Resistente a Humedad) obligatorio" which applies perfectly to bano modules.

**2. Add cajones selector for bajoLavabo and cajoneraBano in step2():**

Find the existing cajones selector pattern (used for cocina cajonera, around `m.type === 'cajonera'`). This creates a dropdown/button group for cajón count. Add the same pattern for bano types:

After the existing cajonera cajones selector block, add:
```javascript
if (m.type === 'bajoLavabo') {
    // Cajones selector: 1 or 2 (default 2)
    h += '<div style="margin:4px 0"><span style="font-size:12px;color:#aaa">Cajones: </span>';
    [1, 2].forEach(function(n) {
        var sel = (m.cajones || 2) === n;
        h += '<button onclick="P.modules[' + i + '].cajones=' + n + ';APP.setModShelves(' + i + ',' + n + ')" style="padding:2px 10px;margin:0 2px;border-radius:4px;border:1px solid ' + (sel ? '#c49a6c' : '#333') + ';background:' + (sel ? '#c49a6c' : '#1a1a1a') + ';color:' + (sel ? '#000' : '#aaa') + ';cursor:pointer;font-size:12px">' + n + '</button>';
    });
    h += '</div>';
}
if (m.type === 'cajoneraBano') {
    // Cajones selector: 2 or 3 (default 2)
    h += '<div style="margin:4px 0"><span style="font-size:12px;color:#aaa">Cajones: </span>';
    [2, 3].forEach(function(n) {
        var sel = (m.cajones || 2) === n;
        h += '<button onclick="P.modules[' + i + '].cajones=' + n + ';APP.setModShelves(' + i + ',' + n + ')" style="padding:2px 10px;margin:0 2px;border-radius:4px;border:1px solid ' + (sel ? '#c49a6c' : '#333') + ';background:' + (sel ? '#c49a6c' : '#1a1a1a') + ';color:' + (sel ? '#000' : '#aaa') + ';cursor:pointer;font-size:12px">' + n + '</button>';
    });
    h += '</div>';
}
```

Note: `APP.setModShelves(i, n)` is the existing function used for cocina modules to update cajones count and re-render (confirmed in STATE.md decisions).

**3. Ensure bano modules pass cajones to calculateParts and assignHardware:**

In calc(), verify that when calling calculateParts() and assignHardware() for bano module types, `materials.cajones` (or `options.cajones`) is populated from `m.cajones`. Check the existing pattern for cocina cajonera — it passes `m.cajones` via the materials object. Ensure the same pattern works for bajoLavabo and cajoneraBano.

If the existing generic code already passes `m.cajones` through (likely via `Object.assign` or direct copy in calc()), confirm this. If not, add explicit passing in calc() where the materials/options object is built.

**4. Extras guard for bano modules:**

The step2() extras guard (excluding certain types from quoteMode/door toggle UI) should include bano cajón types. Find the condition that checks for `zoclo`, `vistaLateral`, etc. and verify that bajoLavabo and cajoneraBano do NOT need to be added here (they are NOT extras — they ARE regular modules that should show quoteMode if applicable). However, botiquin should show door toggle since it has puertas.

Confirm no changes needed to the extras guard — bano modules are regular modules, not extras.
  </action>
  <verify>
Search for:
- `m.type === 'bajoLavabo'` in the MDF-RH validation condition (should be alongside fregadero)
- `m.type === 'cajoneraBano'` in the MDF-RH validation condition
- `m.type === 'botiquin'` in the MDF-RH validation condition
- `m.type === 'bajoLavabo'` with cajones selector (forEach with [1, 2])
- `m.type === 'cajoneraBano'` with cajones selector (forEach with [2, 3])
- `id: 'bano'` in TYPES exists

Manual verification: Open the HTML file in a browser, select "Bano" as project type, confirm only bano modules appear. Add a bajoLavabo and verify the cajones selector and MDF-RH warning appear.
  </verify>
  <done>Selecting "Bano" project type shows only bano modules. All 3 bano module types show red MDF-RH warning when non-RH material selected. bajoLavabo offers 1-2 cajones selector (default 2). cajoneraBano offers 2-3 cajones selector (default 2). Botiquin shows door toggle for puertas.</done>
</task>

</tasks>

<verification>
1. TYPES array contains `{ id: 'bano', n: 'Bano', i: '&#x1f6bf;' }`
2. step2() filters to only bano modules when P.type === 'bano' (via existing forType mechanism)
3. calc() skips door block for bajoLavabo and cajoneraBano
4. calc() generates puertas for botiquin (1 or 2 based on width)
5. MDF-RH red warning appears for ALL bano modules when non-RH material selected
6. cajones selector appears for bajoLavabo (1-2) and cajoneraBano (2-3)
7. Existing cocina and closet functionality unaffected
</verification>

<success_criteria>
User can select "Bano" in Step 1, see only bathroom modules in Step 2, configure cajones for lavabo/cajonera, and receive MDF-RH warnings for any non-resistant-humidity material selection. Botiquin generates puertas with bisagras. All existing project types continue working correctly.
</success_criteria>

<output>
After completion, create `.planning/phases/05-banos/05-02-SUMMARY.md`
</output>
