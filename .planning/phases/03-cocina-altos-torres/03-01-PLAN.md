---
phase: 03-cocina-altos-torres
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [CALT-01, CALT-02, CALT-03, CTOR-01, CTOR-02]

must_haves:
  truths:
    - "calculateParts('alacenaEstandar', ...) returns costados, techo, base, fondo HDF, and 1-2 entrepaños"
    - "calculateParts('alacenaAventos', ...) returns costados, techo, base, fondo HDF, and single puerta elevable piece"
    - "calculateParts('alacenaSobreCampana', ...) returns same structure as alacenaEstandar but with reduced depth from dimensions.d"
    - "calculateParts('torreHornos', ...) returns costados, base, techo, fondo with ventilación, entrepaño microondas at configurable height, entrepaño horno at 595mm, and cajón inferior pieces"
    - "calculateParts('torreDespensa', ...) returns costados, techo, base, fondo HDF, and configurable entrepaños (4 default, 32mm system)"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "5 new MODS entries, 1+ new HW_DEFAULTS key (aventos), 5 new calculateParts() blocks"
      contains: "alacenaEstandar"
  key_links:
    - from: "MODS.alacenaEstandar"
      to: "calculateParts('alacenaEstandar')"
      via: "moduleType string match"
      pattern: "moduleType === 'alacenaEstandar'"
    - from: "MODS.torreHornos"
      to: "calculateParts('torreHornos')"
      via: "moduleType string match"
      pattern: "moduleType === 'torreHornos'"
---

<objective>
Add MODS entries, HW_DEFAULTS keys, and calculateParts() blocks for all 5 new cocina alto + torre module types: alacenaEstandar, alacenaAventos, alacenaSobreCampana, torreHornos, torreDespensa.

Purpose: Data layer must exist before hardware assignment and UI can be wired (Plan 02 depends on this).
Output: 5 new module types in MODS, new HW_DEFAULTS keys (aventos_hk, aventos_hl, aventos_hs, soporte_alacena), 5 calculateParts() else-if blocks with AUDIT-commented dimension formulas.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-cocina-bajos/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MODS entries and HW_DEFAULTS for cocina altos + torres</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add 5 new MODS entries after the `hornoBase` entry (line ~3251), before the `puerta` entry. Add a section comment `// Cocina Alacenas — Prof: 30-35cm, Alto: 70-90cm` before alacena types, and `// Cocina Torres — Prof: 58-60cm, Alto total: 220-240cm` before torre types.

New MODS entries:
```
alacenaEstandar: {
    n: 'Alacena Est\u00e1ndar',
    w: [30, 40, 45, 50, 60, 75, 80, 90],
    d: '1-2 puertas, 1-2 entrepa\u00f1os | Prof: 30-35cm, Alto: 70-90cm'
},
alacenaAventos: {
    n: 'Alacena Aventos',
    w: [60, 75, 80, 90],
    d: 'Puerta elevable Blum Aventos (HK/HL/HS) | Prof: 30-35cm'
},
alacenaSobreCampana: {
    n: 'Alacena Sobre Campana',
    w: [60, 70, 80, 90],
    d: 'Sobre campana o refri, prof. reducida | Prof: 20-30cm'
},
torreHornos: {
    n: 'Torre de Hornos',
    w: [60, 75, 90],
    d: 'Microondas + horno, caj\u00f3n inferior, ventilaci\u00f3n | Prof: 58-60cm'
},
torreDespensa: {
    n: 'Torre Despensa',
    w: [40, 50, 60],
    d: 'Entrepa\u00f1os regulables 32mm, 2 puertas (sup+inf) | Prof: 58-60cm'
}
```

Add HW_DEFAULTS keys after the `bisagra_165` guarded conditional (line ~3310), using the same `if (!HW_DEFAULTS.key)` guard pattern:
```
if (!HW_DEFAULTS.aventos_hk) HW_DEFAULTS.aventos_hk = { desc: 'Blum Aventos HK-S', marca: 'DEMO', fallback: 850, cat: 'AVENTOS' };
if (!HW_DEFAULTS.aventos_hl) HW_DEFAULTS.aventos_hl = { desc: 'Blum Aventos HL', marca: 'DEMO', fallback: 1200, cat: 'AVENTOS' };
if (!HW_DEFAULTS.aventos_hs) HW_DEFAULTS.aventos_hs = { desc: 'Blum Aventos HS', marca: 'DEMO', fallback: 1500, cat: 'AVENTOS' };
if (!HW_DEFAULTS.soporte_alacena) HW_DEFAULTS.soporte_alacena = { desc: 'Soporte colgante alacena', marca: 'DEMO', fallback: 25, cat: 'ACC. COCINA' };
```

Use ES5 var-only style. Use unicode escapes for Spanish characters (\u00e1, \u00f1, \u00f3, \u00e9).
  </action>
  <verify>
Search the file for each new MODS key and HW_DEFAULTS key — all 9 entries must be found:
- grep for `alacenaEstandar:`, `alacenaAventos:`, `alacenaSobreCampana:`, `torreHornos:`, `torreDespensa:`
- grep for `aventos_hk`, `aventos_hl`, `aventos_hs`, `soporte_alacena`
  </verify>
  <done>5 MODS entries with correct standard-width arrays exist; 4 HW_DEFAULTS keys with DEMO fallback prices exist</done>
</task>

<task type="auto">
  <name>Task 2: Implement calculateParts() blocks for all 5 cocina alto + torre module types</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add 5 new `else if` blocks in `calculateParts()`, after the `hornoBase` block (line ~4922) and before the `puerta` block (line ~4924). Follow the exact same coding patterns from Phase 2 (ES5, AUDIT comments on every dimension formula, t:3 for HDF fondo, t:TK for structural pieces, z:'i' for interior, z:'f' for frente).

**alacenaEstandar** — Wall cabinet with 1-2 puertas and 1-2 entrepaños:
- Alacena standard dimensions: h from caller (typically 700-900mm), d from caller (300-350mm), w variable
- Pieces: Costado q:2 (d x h), Techo q:1 (w-2*TK x d), Base q:1 (w-2*TK x d), Fondo HDF q:1 (w-2*TK x h, t:3)
- Entrepaño: var ent = typeof materials.shelves === 'number' ? materials.shelves : 1; if ent > 0, push Entrepaño q:ent (w-2*TK x d-TK, t:TK, z:'i')
- AUDIT comments explaining: alacena has no amarres (wall-mounted, not free-standing); entrepaño depth is d-TK to clear fondo

**alacenaAventos** — Single elevating door with Aventos mechanism:
- Same casco as alacenaEstandar: Costado q:2, Techo q:1, Base q:1, Fondo HDF q:1
- NO entrepaño (single open cavity for aventos door sweep)
- The door piece is generated in calc() door block (Plan 02), not here

**alacenaSobreCampana** — Reduced depth variant (same as alacenaEstandar structurally):
- Identical piece formulas to alacenaEstandar — the depth reduction comes from the d parameter passed by the caller
- Entrepaño count default: 1 (shorter cabinet typically has 1 shelf)
- This is structurally the same as alacenaEstandar; the key difference is the caller passes a smaller d value (200-300mm vs 300-350mm)
- BUT give it its own block for clarity and to document the use case. Comment: `// Same casco as alacenaEstandar but depth comes from caller (typically 200-300mm for campana/refri)`

**torreHornos** — Full-height tower with microondas + horno niches + cajón inferior:
- Costado q:2 (d x h — full tower height, typically 2200mm)
- Base q:1 (w-2*TK x d)
- Techo q:1 (w-2*TK x d)
- Entrepaño microondas: q:1 (w-2*TK x d) — positioned at `var microH = materials.microHeight || 400;` mm from top (for microwave niche)
- Entrepaño horno (595mm): q:1 (w-2*TK x d) — at 595mm below microondas entrepaño (same INSTRUCTIVO spec as hornoBase)
- Fondo with ventilación: q:1 (w-2*TK x h, t:3, z:'i') — name includes '(ventilaci\u00f3n 100mm)'
- Cajón inferior pieces (reuse hornoBase pattern): cajH = h - microH - 595 - 3*TK - 10; if cajH > 50, generate Frente cajón inferior (w-2*TK-4 x 150, c:4, z:'f'), Costado cajón (d-80 x 120, q:2), Frente int. cajón (w-2*TK-26 x 120), Fondo cajón HDF (w-2*TK-26 x d-80, t:3)

**torreDespensa** — Full-height pantry with adjustable shelves on 32mm system:
- Costado q:2 (d x h — full tower height)
- Base q:1 (w-2*TK x d)
- Techo q:1 (w-2*TK x d)
- Fondo HDF q:1 (w-2*TK x h, t:3)
- Entrepaños: var ent = typeof materials.shelves === 'number' ? materials.shelves : 4; push Entrepaño q:ent (w-2*TK x d-TK, t:TK, z:'i')
- Comment: `// AUDIT: entrepaños on 32mm system — adjustable via shelf pins, not fixed`

All pieces must use AUDIT comment convention. Use unicode escapes for accented characters.
  </action>
  <verify>
Search the file for each new calculateParts block — all 5 must be found:
- grep for `moduleType === 'alacenaEstandar'`
- grep for `moduleType === 'alacenaAventos'`
- grep for `moduleType === 'alacenaSobreCampana'`
- grep for `moduleType === 'torreHornos'`
- grep for `moduleType === 'torreDespensa'`
Count total pieces pushed per block to verify completeness.
  </verify>
  <done>
- alacenaEstandar returns Costado x2, Techo, Base, Fondo HDF, Entrepaño (configurable 1-2)
- alacenaAventos returns Costado x2, Techo, Base, Fondo HDF (no entrepaño)
- alacenaSobreCampana returns same structure as alacenaEstandar with caller-supplied reduced depth
- torreHornos returns Costado x2, Base, Techo, Entrepaño micro, Entrepaño horno 595mm, Fondo ventilación, cajón inferior pieces
- torreDespensa returns Costado x2, Techo, Base, Fondo HDF, 4 entrepaños (32mm system default)
  </done>
</task>

</tasks>

<verification>
- All 5 new MODS keys exist with correct width arrays
- All 4 new HW_DEFAULTS keys exist with DEMO fallback prices
- All 5 calculateParts() blocks exist and follow AUDIT comment convention
- No regressions: existing module types (closet, TV, bajos) blocks unchanged
- ES5 only: no let/const/arrow/template literals
</verification>

<success_criteria>
calculateParts() can be called for any of the 5 new module types and returns a non-empty pieces array with correct dimensions and zone flags.
</success_criteria>

<output>
After completion, create `.planning/phases/03-cocina-altos-torres/03-01-SUMMARY.md`
</output>
