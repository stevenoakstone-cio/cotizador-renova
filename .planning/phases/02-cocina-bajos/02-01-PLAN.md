---
phase: 02-cocina-bajos
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements:
  - CBAJ-01
  - CBAJ-02
  - CBAJ-03
  - CBAJ-04
  - CBAJ-05

must_haves:
  truths:
    - "calculateParts('bajoEstandar', ...) returns pieces for fondo, lados, base, techo, entrepaño, and 2 amarres"
    - "calculateParts('fregadero', ...) returns pieces with no techo, 2 amarres (frontal+trasero), and notes saque trasero"
    - "calculateParts('cajonera', ...) returns correct cajón box pieces (frente, costados, respaldo, fondo) for 2/3/4 cajones"
    - "calculateParts('esquineroCiego', ...) returns pieces for a blind corner module"
    - "calculateParts('hornoBase', ...) returns pieces with entrepaño at 595mm and a cajón inferior"
    - "MODS object contains entries for all 5 bajo module types with correct widths"
    - "HW_DEFAULTS contains pata, zoclo_clip, corr_tandem, and bisagra_165 keys"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "5 new calculateParts blocks + MODS entries + HW_DEFAULTS keys"
      contains: "bajoEstandar|fregadero|cajonera|esquineroCiego|hornoBase"
  key_links:
    - from: "MODS object"
      to: "calculateParts() moduleType switch"
      via: "moduleType string matching"
      pattern: "moduleType === 'bajoEstandar'|'fregadero'|'cajonera'|'esquineroCiego'|'hornoBase'"
---

<objective>
Define the 5 cocina bajo module types in the data layer (MODS, HW_DEFAULTS) and implement their piece-generation logic in calculateParts().

Purpose: The despiece (cut list) is the core value of the app. Each bajo module type has specific piece formulas per INSTRUCTIVO_TECNICO.md that differ from existing closet modules.

Output: 5 new `else if` blocks in calculateParts(), new MODS entries, new HW_DEFAULTS keys.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@INSTRUCTIVO_TECNICO.md
@cotizador-template/cotizador-template.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MODS entries and HW_DEFAULTS for cocina bajos</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add 5 new module type entries to the MODS object (after the existing cocina section near line 3195). Use these exact IDs and specs from INSTRUCTIVO_TECNICO.md:

```javascript
// Cocina Bajos — Prof: 58cm, Alto casco: 72cm, Alto total: 85-90cm con patas y cubierta
bajoEstandar: {
    n: 'Bajo Estandar',
    w: [30, 40, 45, 50, 60, 75, 80, 90, 100],
    d: 'Gabinete base 1-2 puertas | Prof: 58cm, Alto: 72cm'
},
fregadero: {
    n: 'Fregadero',
    w: [60, 75, 80, 90],
    d: 'Sin techo, 2 amarres, saque trasero | Prof: 58cm'
},
cajonera: {
    n: 'Cajonera',
    w: [30, 40, 45, 50, 60, 75, 80, 90],
    d: '2-4 cajones Blum Tandem | Prof: 58cm'
},
esquineroCiego: {
    n: 'Esquinero Ciego',
    w: [90],
    d: 'Esquinero 90x90 ciego o en L (165\u00b0)'
},
hornoBase: {
    n: 'Horno Base',
    w: [60, 75, 90],
    d: 'Nicho horno 595mm + caj\u00f3n inferior'
},
```

Also add these new HW_DEFAULTS keys after the existing fallback block (near line 3279):

```javascript
if (!HW_DEFAULTS.pata) HW_DEFAULTS.pata = { desc: 'Pata regulable cocina', marca: 'DEMO', fallback: 35, cat: 'ACC. COCINA' };
if (!HW_DEFAULTS.zoclo_clip) HW_DEFAULTS.zoclo_clip = { desc: 'Clip zoclo cocina', marca: 'DEMO', fallback: 8, cat: 'ACC. COCINA' };
if (!HW_DEFAULTS.corr_tandem) HW_DEFAULTS.corr_tandem = { desc: 'Corredera Blum Tandem soft-close', marca: 'DEMO', fallback: 350, cat: 'CORREDERA' };
if (!HW_DEFAULTS.bisagra_165) HW_DEFAULTS.bisagra_165 = { desc: 'Bisagra 165\u00b0 esquinero', marca: 'DEMO', fallback: 45, cat: 'BISAGRA' };
```

Also add these to the commented-out REAL HW_DEFAULTS block for future use:
```javascript
pata: { desc: 'Pata regulable cocina 100-150mm', marca: 'HERRAXA', fallback: 28.00, cat: 'ACC. COCINA' },
zoclo_clip: { desc: 'Clip fijacion zoclo', marca: 'HERRAXA', fallback: 6.50, cat: 'ACC. COCINA' },
corr_tandem: { desc: 'Blum Tandem cierre suave', marca: 'HERRAXA', fallback: 289.00, cat: 'CORREDERA' },
bisagra_165: { desc: 'Bisagra 165 grados esquinero', marca: 'HERRAXA', fallback: 38.00, cat: 'BISAGRA' },
```

NOTE: Do NOT remove or rename the existing `gabineteBase`, `cajonBase`, or `esquineroGiratorio` entries — those are existing closet/cocina types from Phase 1 that must remain for backward compatibility. The new `bajoEstandar`, `fregadero`, `cajonera`, `esquineroCiego`, and `hornoBase` are ADDITIONAL cocina-specific module types.
  </action>
  <verify>
Open cotizador-template.html in browser. Open DevTools console. Verify:
- `typeof MODS.bajoEstandar !== 'undefined'` — returns true
- `typeof MODS.fregadero !== 'undefined'` — returns true
- `typeof MODS.cajonera !== 'undefined'` — returns true
- `typeof MODS.esquineroCiego !== 'undefined'` — returns true
- `typeof MODS.hornoBase !== 'undefined'` — returns true
- `typeof HW_DEFAULTS.pata !== 'undefined'` — returns true
- `typeof HW_DEFAULTS.zoclo_clip !== 'undefined'` — returns true
- `typeof HW_DEFAULTS.corr_tandem !== 'undefined'` — returns true
- `typeof HW_DEFAULTS.bisagra_165 !== 'undefined'` — returns true
  </verify>
  <done>MODS has all 5 new bajo module type entries with correct width arrays. HW_DEFAULTS has pata, zoclo_clip, corr_tandem, and bisagra_165 keys with fallback prices.</done>
</task>

<task type="auto">
  <name>Task 2: Implement calculateParts() blocks for all 5 cocina bajo module types</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add 5 new `else if` blocks to `calculateParts()` (before the `puerta` block, after `esquineroGiratorio`). Follow the INSTRUCTIVO_TECNICO.md formulas exactly. Use 15mm (TK) thickness throughout. All dimensions in mm.

**Common cocina bajo constants (use inline, not a separate var):**
- Cocina casco height: passed in as `h` (typically 720mm)
- Cocina depth: passed in as `d` (typically 580mm)
- Inner width: `w - 2 * TK` (= w - 30 at 15mm)
- Amarre height: 80mm

**1. bajoEstandar** — Standard base cabinet per INSTRUCTIVO 3.3:
```javascript
} else if (moduleType === 'bajoEstandar') {
    // Cocina: base cabinet with 1-2 puertas (auto by width)
    // AUDIT: Costados — full casco height × depth (outer structural panels)
    pieces.push({ n: 'Costado',  q: 2, w: d,           h: h,    t: TK, z: 'i' });
    // AUDIT: Base — inner width (w - 2*TK = w - 30 at 15mm) × depth
    pieces.push({ n: 'Base',     q: 1, w: w - 2 * TK,  h: d,    t: TK, z: 'i' });
    // AUDIT: Techo — same as base (inner width × depth), closes the box on top
    pieces.push({ n: 'Techo',    q: 1, w: w - 2 * TK,  h: d,    t: TK, z: 'i' });
    // AUDIT: Fondo HDF — inner width × casco height (backs the box)
    pieces.push({ n: 'Fondo',    q: 1, w: w - 2 * TK,  h: h,    t: 3,  z: 'i' });
    // AUDIT: Amarre frontal superior — inner width × 80mm structural brace
    pieces.push({ n: 'Amarre sup.', q: 1, w: w - 2 * TK, h: 80, t: TK, z: 'i' });
    // AUDIT: Amarre frontal inferior — inner width × 80mm structural brace
    pieces.push({ n: 'Amarre inf.', q: 1, w: w - 2 * TK, h: 80, t: TK, z: 'i' });
    // AUDIT: Entrepaño — inner width minus 30mm more for clearance × (depth - 15mm for fondo)
    pieces.push({ n: 'Entrepa\u00f1o', q: 1, w: w - 2 * TK - 30, h: d - TK, t: TK, z: 'i' });
}
```

**2. fregadero** — Sink module per INSTRUCTIVO 3.3 (no techo, 2 amarres, saque trasero flag):
```javascript
} else if (moduleType === 'fregadero') {
    // Cocina: sink module — NO techo (tarja sits on top), 2 amarres only, saque trasero for tuberias
    // AUDIT: Costados — full casco height × depth
    pieces.push({ n: 'Costado',  q: 2, w: d,           h: h,    t: TK, z: 'i' });
    // AUDIT: Base — inner width × depth
    pieces.push({ n: 'Base',     q: 1, w: w - 2 * TK,  h: d,    t: TK, z: 'i' });
    // AUDIT: NO techo — replaced by 2 amarres (tarja occupies the top opening)
    // AUDIT: Amarre frontal — inner width × 80mm (structural brace where techo would be)
    pieces.push({ n: 'Amarre frontal', q: 1, w: w - 2 * TK, h: 80, t: TK, z: 'i' });
    // AUDIT: Amarre trasero — inner width × 80mm (rear brace)
    pieces.push({ n: 'Amarre trasero', q: 1, w: w - 2 * TK, h: 80, t: TK, z: 'i' });
    // AUDIT: Fondo HDF with saque notation — inner width × casco height
    pieces.push({ n: 'Fondo (saque trasero)', q: 1, w: w - 2 * TK, h: h, t: 3, z: 'i' });
    // NO entrepaño — space is free for plumbing
}
```

**3. cajonera** — Drawer module per INSTRUCTIVO 3.3:
```javascript
} else if (moduleType === 'cajonera') {
    // Cocina: drawer module with 2-4 cajones and Blum Tandem correderas
    var caj = typeof materials.cajones === 'number' ? materials.cajones : 3;
    // AUDIT: Costados — full casco height × depth
    pieces.push({ n: 'Costado',  q: 2, w: d,           h: h,    t: TK, z: 'i' });
    // AUDIT: Base — inner width × depth
    pieces.push({ n: 'Base',     q: 1, w: w - 2 * TK,  h: d,    t: TK, z: 'i' });
    // AUDIT: Amarre superior — inner width × 80mm (no techo on cajoneras, just amarre)
    pieces.push({ n: 'Amarre sup.', q: 1, w: w - 2 * TK, h: 80, t: TK, z: 'i' });
    // AUDIT: Fondo HDF — inner width × casco height
    pieces.push({ n: 'Fondo',    q: 1, w: w - 2 * TK,  h: h,    t: 3,  z: 'i' });
    if (caj > 0) {
        // AUDIT: ch = usable casco height minus 100mm structure / number of cajones
        var ch = Math.floor((h - 100) / caj);
        // AUDIT: Frente cajon — inner width - 4mm juego × ch - 4mm juego; 4 edges chapa; zone='f'
        pieces.push({ n: 'Frente caj\u00f3n', q: caj, w: w - 2 * TK - 4, h: ch - 4, t: TK, c: 4, z: 'f' });
        // AUDIT: Costado cajon — (depth - 80mm slide) × (ch - 30mm slide height); per INSTRUCTIVO
        pieces.push({ n: 'Costado caj\u00f3n', q: caj * 2, w: d - 80, h: ch - 30, t: TK, z: 'i' });
        // AUDIT: Frente int. cajon — (inner width - 26mm for correderas x2) × (ch - 30mm)
        pieces.push({ n: 'Frente int. caj\u00f3n', q: caj, w: w - 2 * TK - 26, h: ch - 30, t: TK, z: 'i' });
        // AUDIT: Fondo cajon HDF — same width as frente int × (depth - 80mm)
        pieces.push({ n: 'Fondo caj\u00f3n', q: caj, w: w - 2 * TK - 26, h: d - 80, t: 3, z: 'i' });
    }
}
```

**4. esquineroCiego** — Blind corner or L-corner per INSTRUCTIVO 3.3:
```javascript
} else if (moduleType === 'esquineroCiego') {
    // Cocina: blind corner module (esquinero ciego) or esquinero en L
    // w = total width of visible face, w2 = depth into corner (second leg)
    var w2ec = dimensions.w2 !== undefined ? dimensions.w2 : w;
    // AUDIT: Costado visible — full depth × casco height (the exposed side)
    pieces.push({ n: 'Costado visible', q: 1, w: d, h: h, t: TK, z: 'i' });
    // AUDIT: Costado ciego — w2 leg depth × casco height (the blind/corner side)
    pieces.push({ n: 'Costado ciego',  q: 1, w: w2ec, h: h, t: TK, z: 'i' });
    // AUDIT: Base — full module footprint (w - TK) × (w2 - TK)
    pieces.push({ n: 'Base',  q: 1, w: w - TK, h: w2ec - TK, t: TK, z: 'i' });
    // AUDIT: Techo — same dimensions as base
    pieces.push({ n: 'Techo', q: 1, w: w - TK, h: w2ec - TK, t: TK, z: 'i' });
    // AUDIT: Fondo — w × h (backs the module)
    pieces.push({ n: 'Fondo', q: 1, w: w - 2 * TK, h: h, t: 3, z: 'i' });
    // AUDIT: Entrepaño — same as base minus clearance
    pieces.push({ n: 'Entrepa\u00f1o', q: 1, w: w - TK - 30, h: w2ec - TK - TK, t: TK, z: 'i' });
}
```

**5. hornoBase** — Oven base module per INSTRUCTIVO 3.3:
```javascript
} else if (moduleType === 'hornoBase') {
    // Cocina: oven base module — entrepaño at 595mm for oven niche, cajón inferior, ventilación
    // AUDIT: Costados — full casco height × depth
    pieces.push({ n: 'Costado',  q: 2, w: d, h: h, t: TK, z: 'i' });
    // AUDIT: Base — inner width × depth
    pieces.push({ n: 'Base',     q: 1, w: w - 2 * TK, h: d, t: TK, z: 'i' });
    // AUDIT: Techo — inner width × depth (closes the top)
    pieces.push({ n: 'Techo',    q: 1, w: w - 2 * TK, h: d, t: TK, z: 'i' });
    // AUDIT: Entrepa\u00f1o horno — at 595mm from top for oven niche (INSTRUCTIVO: 595-598mm nicho)
    pieces.push({ n: 'Entrepa\u00f1o horno (595mm)', q: 1, w: w - 2 * TK, h: d, t: TK, z: 'i' });
    // AUDIT: Fondo HDF — inner width × casco height (note: needs 100mm ventilación clearance behind oven)
    pieces.push({ n: 'Fondo (ventilaci\u00f3n 100mm)', q: 1, w: w - 2 * TK, h: h, t: 3, z: 'i' });
    // AUDIT: Cajón inferior pieces — below the oven niche
    // Cajón height = casco height - 595mm oven niche - TK entrepaño - TK base - clearance
    var cajH = h - 595 - TK - TK - 10;
    if (cajH > 50) {
        // AUDIT: Frente cajon inferior — 150mm standard per INSTRUCTIVO; 4 chapa edges; zone='f'
        pieces.push({ n: 'Frente caj\u00f3n inferior', q: 1, w: w - 2 * TK - 4, h: 150, t: TK, c: 4, z: 'f' });
        // AUDIT: Costado cajon — (depth - 80mm slide) × (150mm - 30mm)
        pieces.push({ n: 'Costado caj\u00f3n', q: 2, w: d - 80, h: 120, t: TK, z: 'i' });
        // AUDIT: Frente int. cajon — (inner width - 26mm correderas) × 120mm
        pieces.push({ n: 'Frente int. caj\u00f3n', q: 1, w: w - 2 * TK - 26, h: 120, t: TK, z: 'i' });
        // AUDIT: Fondo cajon — same width as frente int × (depth - 80mm)
        pieces.push({ n: 'Fondo caj\u00f3n', q: 1, w: w - 2 * TK - 26, h: d - 80, t: 3, z: 'i' });
    }
}
```

**IMPORTANT coding conventions:**
- ES5 only: `var`, no `let`/`const`, no arrow functions, no template literals
- Use `\u00f1` for ñ, `\u00e9` for é, `\u00f3` for ó in strings
- Every formula constant gets an `// AUDIT:` comment explaining the deduction
- Piece objects: `{ n, q, w, h, t, z }` with optional `c` for chapacanto edge count
- Zone: `'i'` for interior/casco, `'f'` for frente/visible
- Fondo pieces use `t: 3` (3mm HDF) per INSTRUCTIVO
  </action>
  <verify>
Open browser DevTools console and test each module type:
```javascript
// Test bajoEstandar
var p1 = calculateParts('bajoEstandar', {w:600,h:720,d:580}, {thickness:15});
console.log('bajoEstandar pieces:', p1.length, p1.map(function(p){return p.n}));
// Should have: Costado, Base, Techo, Fondo, Amarre sup., Amarre inf., Entrepaño (7 pieces)

// Test fregadero
var p2 = calculateParts('fregadero', {w:600,h:720,d:580}, {thickness:15});
console.log('fregadero pieces:', p2.length, p2.map(function(p){return p.n}));
// Should have: Costado, Base, Amarre frontal, Amarre trasero, Fondo (5 pieces, NO techo, NO entrepaño)

// Test cajonera
var p3 = calculateParts('cajonera', {w:600,h:720,d:580}, {thickness:15, cajones:3});
console.log('cajonera pieces:', p3.length, p3.map(function(p){return p.n}));
// Should have: Costado, Base, Amarre sup., Fondo, + 4 cajón piece types × 3 cajones

// Test esquineroCiego
var p4 = calculateParts('esquineroCiego', {w:900,h:720,d:580,w2:900}, {thickness:15});
console.log('esquineroCiego pieces:', p4.length, p4.map(function(p){return p.n}));
// Should have: Costado visible, Costado ciego, Base, Techo, Fondo, Entrepaño (6 pieces)

// Test hornoBase
var p5 = calculateParts('hornoBase', {w:600,h:720,d:580}, {thickness:15});
console.log('hornoBase pieces:', p5.length, p5.map(function(p){return p.n}));
// Should have: Costado, Base, Techo, Entrepaño horno, Fondo, + cajón pieces (9-10 pieces)
```
  </verify>
  <done>calculateParts() returns the correct despiece for all 5 cocina bajo module types matching INSTRUCTIVO_TECNICO.md formulas. Each piece has AUDIT comments explaining dimension deductions.</done>
</task>

</tasks>

<verification>
1. All 5 bajo module IDs exist in MODS with correct width arrays
2. All 4 new HW_DEFAULTS keys exist with fallback prices
3. calculateParts() handles all 5 new moduleType strings
4. Piece names match INSTRUCTIVO_TECNICO.md terminology
5. Fondo pieces use t:3 (HDF 3mm) per spec
6. Fregadero has NO techo and NO entrepaño
7. HornoBase has entrepaño at 595mm and cajón inferior
8. All existing module types still work (backward compatibility)
</verification>

<success_criteria>
- 5 new MODS entries with correct width arrays
- 4 new HW_DEFAULTS entries (pata, zoclo_clip, corr_tandem, bisagra_165)
- 5 new calculateParts() blocks returning correct piece arrays
- Every dimension formula has an AUDIT comment
- Zero regressions in existing closet/TV module types
</success_criteria>

<output>
After completion, create `.planning/phases/02-cocina-bajos/02-01-SUMMARY.md`
</output>
