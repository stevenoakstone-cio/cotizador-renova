---
phase: 02-cocina-bajos
plan: "03"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements:
  - CBAJ-03
gap_closure: true

must_haves:
  truths:
    - "User can select 2, 3, or 4 cajones for a cajonera module in the step2 UI"
    - "Changing cajones count updates the despiece to show the correct number of cajon pieces"
    - "Blum Tandem correderas quantity matches the selected cajon count"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "cajones selector UI for cajonera type in step2()"
      contains: "m.type === 'cajonera'"
  key_links:
    - from: "step2() cajonera selector buttons"
      to: "APP.setModC()"
      via: "onclick handler"
      pattern: "APP\\.setModC\\("
---

<objective>
Add a cajones selector for the `cajonera` bajo type in step2() so users can choose 2, 3, or 4 cajones.

Purpose: Close the CBAJ-03 verification gap — the data layer already honors `m.cajones` but no UI control exists for `cajonera` modules, locking users to the default of 3.
Output: Updated step2() with cajones buttons for cajonera type.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-cocina-bajos/02-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cajones selector for cajonera type in step2()</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
In the step2() function, immediately after the `cajonBase` cajones selector block (which ends at approximately line 7042, after the closing `}`), add a new conditional block for `cajonera`:

```javascript
if (m.type === 'cajonera') {
    var mcaj = typeof m.cajones === 'number' ? m.cajones : 3;
    h += '<div class="module-row"><span>Cajones:</span><div style="display:flex;gap:6px;flex-wrap:wrap">';
    [2, 3, 4].forEach(function(n) {
        h += '<button class="opt-btn' + (mcaj === n ? ' sel' : '') + '" onclick="APP.setModC(\'' + m.id + '\',' + n + ')">' + n + '</button>';
    });
    h += '</div></div>';
}
```

This follows the exact same pattern as the `cajonBase` block (lines 7035-7041) but offers only [2, 3, 4] options per the MODS description "2-4 cajones Blum Tandem". The default remains 3 (matching the fallback in calculateParts and assignHardware). APP.setModC() already exists and works for all module types.

Do NOT modify calculateParts(), assignHardware(), or any other function — they already correctly handle any `m.cajones` value.
  </action>
  <verify>
1. Search the file for `m.type === 'cajonera'` in the step2() region to confirm the block exists.
2. Confirm the block offers exactly [2, 3, 4] options.
3. Confirm it calls APP.setModC() with the module id and selected count.
4. Confirm no other code was modified (calculateParts, assignHardware unchanged).
  </verify>
  <done>
The step2() UI renders a "Cajones" row with buttons [2, 3, 4] when the module type is 'cajonera'. Selecting a button calls APP.setModC() which sets m.cajones, and the existing calculateParts/assignHardware functions use that value to generate the correct number of cajon pieces and correderas.
  </done>
</task>

</tasks>

<verification>
- Open the app in a browser, add a Cajonera module in step 2
- Verify buttons [2, 3, 4] appear with 3 pre-selected
- Click "2" — proceed to step 3 — despiece should show 2 sets of cajon pieces (Frente cajon, Costado cajon x2, Frente int. cajon, Fondo cajon) and hardware should show corr_tandem q:2
- Click "4" — despiece should show 4 sets and corr_tandem q:4
</verification>

<success_criteria>
- Cajonera modules in step2() show a cajones selector with options 2, 3, 4
- Default selection is 3 (matching existing behavior)
- Changing the selection updates despiece piece count and corredera hardware count
- CBAJ-03 verification gap is closed
</success_criteria>

<output>
After completion, create `.planning/phases/02-cocina-bajos/02-03-SUMMARY.md`
</output>
