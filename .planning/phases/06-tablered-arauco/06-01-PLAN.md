---
phase: 06-tablered-arauco
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [TABL-01, TABL-02, TABL-03, TABL-04]
must_haves:
  truths:
    - "calculateParts('librero',...) returns exactly 9 pieces (A-I) with correct fixed dimensions"
    - "calculateParts('credenzaTV',...) returns exactly 7 pieces (A-G) with correct fixed dimensions"
    - "calculateParts('mesaCentro',...) returns exactly 9 pieces across 2 blocks (KIRA 5 + NERO 4)"
    - "assignHardware returns correct fixed hardware for each Tablered product"
    - "User can select librero, credenza, or mesa_centro as project type in Step 1"
    - "Module picker shows only the single Tablered module for the selected project type"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "MODS entries, calculateParts blocks, assignHardware blocks, TYPES entries for 3 Tablered products"
      contains: "librero"
  key_links:
    - from: "MODS.librero"
      to: "calculateParts('librero',...)"
      via: "calc() delegation"
      pattern: "moduleType === 'librero'"
    - from: "MODS.credenzaTV"
      to: "calculateParts('credenzaTV',...)"
      via: "calc() delegation"
      pattern: "moduleType === 'credenzaTV'"
    - from: "MODS.mesaCentro"
      to: "calculateParts('mesaCentro',...)"
      via: "calc() delegation"
      pattern: "moduleType === 'mesaCentro'"
---

<objective>
Add all three Tablered Arauco catalog products (Librero KIRA, Credenza TV NERO, Mesa de Centro) as fixed-despiece module types with TYPES entries, MODS entries, calculateParts() blocks, assignHardware() blocks, and calc() door/cubrecanto integration.

Purpose: These are FIXED catalog products with exact piece counts and dimensions from the INSTRUCTIVO TECNICO. Unlike parametric modules (cocina, bano), the despiece is hardcoded — no dimension formulas needed. Cubrecanto (edge banding in ml) must be included as a line item in the pieces array.

Output: Three fully functional Tablered product types that generate complete despiece and hardware when added to a project.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@INSTRUCTIVO_TECNICO.md (Sections 8, 9, 10 — Credenza, Librero, Mesa de Centro)
</context>

<tasks>

<task type="auto">
  <name>Task 1: MODS entries + TYPES entries + calculateParts() for 3 Tablered products</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**1. Add TYPES entries** for `librero` and `mesa_centro` (credenza already exists in TYPES):

```javascript
// In TYPES array, add:
{ id: 'librero', n: 'Librero', i: '&#x1f4da;' },
{ id: 'mesa_centro', n: 'Mesa de Centro', i: '&#x2615;' }
```

**2. Add MODS entries** after the bano modules block. These are FIXED catalog products — single width option, no configurability. Use forType to filter each product to its own project type:

```javascript
// Tablered Arauco — Fixed catalog products (exact INSTRUCTIVO dimensions)
librero: {
    n: 'Librero KIRA',
    w: [138.5],  // Fixed: 1385mm total width
    d: 'Tablered Arauco | KIRA 15mm | 1385x400x1800mm | 9 piezas',
    forType: ['librero'],
    cat: 'Tablered'
},
credenzaTV: {
    n: 'Credenza TV NERO',
    w: [160],  // Fixed: 1600mm
    d: 'Tablered Arauco | NERO 15mm | 1600x450x440mm | 7 piezas',
    forType: ['credenza'],
    cat: 'Tablered'
},
mesaCentro: {
    n: 'Mesa de Centro',
    w: [100],  // Fixed: 1000mm
    d: 'Tablered Arauco | NERO+KIRA bicolor | 1000x600x400mm | 9 piezas (2 bloques)',
    forType: ['mesa_centro'],
    cat: 'Tablered'
}
```

**3. Add calculateParts() blocks** for each Tablered product type. These return FIXED piece arrays (not calculated from dimensions). Each piece has label (A, B, C...), name, qty, w, h, and a `cubrecanto` field where applicable. Add an `else if` block in calculateParts() for each:

**librero** — 9 piece types, 18 total pieces:
```javascript
else if (moduleType === 'librero') {
    // AUDIT: Tablered Arauco Librero KIRA — fixed catalog despiece (INSTRUCTIVO S.9)
    // Overall: 1385mm wide (1000 izq + 385 der), 400mm deep, 1800mm tall
    pieces = [
        { label: 'A', name: 'Piso/Techo zona izq', q: 2, w: 1000, h: 385, cubrecanto: '3 lados' },
        { label: 'B', name: 'Lateral exterior', q: 2, w: 1770, h: 385, cubrecanto: '2 lados' },
        { label: 'C', name: 'Fondo trasero', q: 1, w: 1770, h: 970, cubrecanto: 'no' },
        { label: 'D', name: 'Puerta media', q: 2, w: 745, h: 335, cubrecanto: '4 lados', isPuerta: true },
        { label: 'E', name: 'Puerta baja', q: 2, w: 385, h: 335, cubrecanto: '4 lados', isPuerta: true },
        { label: 'F', name: 'Repisa larga horizontal', q: 2, w: 970, h: 370, cubrecanto: '1 lado' },
        { label: 'G', name: 'Paral vertical interno', q: 4, w: 699, h: 370, cubrecanto: '1 lado' },
        { label: 'H', name: 'Repisa corta zona der', q: 2, w: 310, h: 370, cubrecanto: '1 lado' },
        { label: 'I', name: 'Repisa media zona der', q: 1, w: 645, h: 370, cubrecanto: '1 lado' }
    ];
    // Cubrecanto total: 59.2 ml PVC 0.45mm KIRA
    pieces.push({ name: 'Cubrecanto PVC KIRA', q: 1, w: 59200, h: 0, unit: 'ml', mlTotal: 59.2, isCubrecanto: true });
}
```

**credenzaTV** — 7 piece types, 16 total pieces:
```javascript
else if (moduleType === 'credenzaTV') {
    // AUDIT: Tablered Arauco Credenza TV NERO — fixed catalog despiece (INSTRUCTIVO S.8)
    // Overall: 1600mm long, 450mm deep, 440mm tall (540mm with patas)
    pieces = [
        { label: 'A', name: 'Piso/Techo', q: 2, w: 1600, h: 450, cubrecanto: '3 lados' },
        { label: 'B', name: 'Fondo trasero', q: 1, w: 1570, h: 435, cubrecanto: 'no' },
        { label: 'C', name: 'Costado exterior', q: 2, w: 410, h: 450, cubrecanto: '2 lados' },
        { label: 'D', name: 'Paral interno vertical', q: 3, w: 410, h: 435, cubrecanto: '1 lado' },
        { label: 'E', name: 'Repisa horizontal interna', q: 4, w: 380, h: 435, cubrecanto: '1 lado' },
        { label: 'F', name: 'Puerta central', q: 2, w: 400, h: 390, cubrecanto: '4 lados', isPuerta: true },
        { label: 'G', name: 'Puerta lateral', q: 2, w: 320, h: 405, cubrecanto: '4 lados', isPuerta: true }
    ];
    // Cubrecanto total: 49 ml PVC 0.45mm NERO
    pieces.push({ name: 'Cubrecanto PVC NERO', q: 1, w: 49000, h: 0, unit: 'ml', mlTotal: 49, isCubrecanto: true });
}
```

**mesaCentro** — 2 blocks, 9 piece types total:
```javascript
else if (moduleType === 'mesaCentro') {
    // AUDIT: Tablered Arauco Mesa de Centro — bicolor KIRA+NERO (INSTRUCTIVO S.10)
    // Overall: 1000mm long, 600mm wide, 400mm tall (450-500mm with patas)
    // BLOQUE 1 = KIRA (tapa abatible), BLOQUE 2 = NERO (nicho abierto)
    pieces = [
        // BLOQUE 1 — KIRA
        { label: 'A', name: 'Tapa abatible', q: 1, w: 600, h: 645, bloque: 'KIRA', cubrecanto: '4 lados', isPuerta: true },
        { label: 'B', name: 'Costado', q: 2, w: 385, h: 650, bloque: 'KIRA', cubrecanto: '2 lados' },
        { label: 'C', name: 'Frente', q: 1, w: 360, h: 570, bloque: 'KIRA', cubrecanto: '1 lado' },
        { label: 'D', name: 'Fondo interno', q: 1, w: 385, h: 570, bloque: 'KIRA', cubrecanto: 'no' },
        { label: 'E', name: 'Piso interno', q: 1, w: 570, h: 635, bloque: 'KIRA', cubrecanto: '1 lado' },
        // BLOQUE 2 — NERO
        { label: 'F', name: 'Piso', q: 1, w: 570, h: 350, bloque: 'NERO', cubrecanto: '1 lado' },
        { label: 'G', name: 'Techo/Cubierta', q: 1, w: 600, h: 350, bloque: 'NERO', cubrecanto: '3 lados' },
        { label: 'H', name: 'Costado', q: 2, w: 385, h: 350, bloque: 'NERO', cubrecanto: '2 lados' },
        { label: 'I', name: 'Fondo interno', q: 1, w: 370, h: 570, bloque: 'NERO', cubrecanto: 'no' }
    ];
    // Cubrecanto total: 12 ml KIRA + 9 ml NERO = 21 ml
    pieces.push({ name: 'Cubrecanto PVC KIRA', q: 1, w: 12000, h: 0, unit: 'ml', mlTotal: 12, isCubrecanto: true });
    pieces.push({ name: 'Cubrecanto PVC NERO', q: 1, w: 9000, h: 0, unit: 'ml', mlTotal: 9, isCubrecanto: true });
}
```

**Important implementation notes:**
- All pieces use the existing piece object shape: `{ name, q, w, h }` plus additional metadata fields
- The `label` field (A, B, C...) matches the official catalog labels for traceability
- The `isPuerta` flag marks frente/door pieces (for material assignment in calc())
- The `isCubrecanto` flag marks cubrecanto line items (for special pricing — NOT sheet-area based)
- The `bloque` field on mesaCentro pieces identifies which material block (KIRA vs NERO)
- The `cubrecanto` field on structural pieces is informational (indicates which edges need banding)
- These are NOT parametric — dimensions are hardcoded, not derived from module width/height/depth
  </action>
  <verify>
Search the file for `moduleType === 'librero'`, `moduleType === 'credenzaTV'`, and `moduleType === 'mesaCentro'` in calculateParts(). Confirm each block returns the correct piece count. Search MODS for `librero:`, `credenzaTV:`, `mesaCentro:`. Search TYPES for `librero` and `mesa_centro`.
  </verify>
  <done>
- TYPES array contains librero and mesa_centro entries (credenza already present)
- MODS has 3 Tablered entries with forType filtering to their respective project types
- calculateParts() has 3 new else-if blocks returning fixed piece arrays matching INSTRUCTIVO exactly
- Piece counts: librero 9+1cubrecanto, credenzaTV 7+1cubrecanto, mesaCentro 9+2cubrecanto
  </done>
</task>

<task type="auto">
  <name>Task 2: assignHardware() + calc() integration for Tablered products</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**1. Add assignHardware() blocks** for each Tablered product. These return FIXED hardware arrays:

**librero:**
```javascript
else if (moduleType === 'librero') {
    // AUDIT: Tablered Librero KIRA — 8 bisagras (4 puertas x 2), 6 regatones (INSTRUCTIVO S.9)
    hw.push({ key: 'bisagra', q: 8 });
    hw.push({ key: 'regaton', q: 6 });
}
```

**credenzaTV:**
```javascript
else if (moduleType === 'credenzaTV') {
    // AUDIT: Tablered Credenza TV NERO — 8 bisagras (4 puertas x 2), 4 patas metalicas 10cm (INSTRUCTIVO S.8)
    hw.push({ key: 'bisagra', q: 8 });
    hw.push({ key: 'pata_metalica', q: 4 });
}
```

**mesaCentro:**
```javascript
else if (moduleType === 'mesaCentro') {
    // AUDIT: Tablered Mesa Centro — 2 bisagras (tapa abatible), 1 piston 150N, 4 patas 5cm (INSTRUCTIVO S.10)
    hw.push({ key: 'bisagra', q: 2 });
    hw.push({ key: 'piston_150n', q: 1 });
    hw.push({ key: 'pata_niveladora', q: 4 });
}
```

**2. Add HW_DEFAULTS entries** for new hardware keys not yet in the object. Check existing HW_DEFAULTS and add only what is missing:
```javascript
// Add if not present:
if (!HW_DEFAULTS.regaton) HW_DEFAULTS.regaton = { n: 'Regaton nivelador tachuela', cost: 8 };
if (!HW_DEFAULTS.pata_metalica) HW_DEFAULTS.pata_metalica = { n: 'Pata metalica 10cm', cost: 85 };
if (!HW_DEFAULTS.piston_150n) HW_DEFAULTS.piston_150n = { n: 'Piston gas 150N', cost: 350 };
if (!HW_DEFAULTS.pata_niveladora) HW_DEFAULTS.pata_niveladora = { n: 'Pata niveladora 5cm', cost: 25 };
```
Use the guarded conditional pattern (`if (!HW_DEFAULTS.key)`) matching Phase 1 established pattern. Cost values are DEMO placeholders (same approach as all other HW_DEFAULTS).

**3. calc() integration — door skip for Tablered products:**
In the calc() door block, Tablered products must SKIP the door auto-generation entirely. The doors/puertas are already included as fixed pieces in calculateParts() (marked with `isPuerta: true`). Add these three module types to the door-skip guard:

```javascript
// In the door skip guard, add:
// ... || moduleType === 'librero' || moduleType === 'credenzaTV' || moduleType === 'mesaCentro'
```

This is the same pattern used by `cajonera` and `hornoBase` which skip the door block because their frentes are handled differently.

**4. calc() — cubrecanto pricing in cost calculation:**
After the piece area/cost calculation loop in calc(), add handling for `isCubrecanto` pieces. These should NOT be priced by sheet area — they use a per-ml cost. Add a small block:

```javascript
// After piece cost loop, handle cubrecanto line items
var cubrecantoCost = 0;
for (var ci = 0; ci < pieces.length; ci++) {
    if (pieces[ci].isCubrecanto) {
        // AUDIT: Cubrecanto PVC 0.45mm — priced per linear meter, not sheet area
        // Demo: ~$15 MXN per ml (adjust in HW_DEFAULTS or CONFIG)
        cubrecantoCost += pieces[ci].mlTotal * (HW_DEFAULTS.cubrecanto_ml ? HW_DEFAULTS.cubrecanto_ml.cost : 15);
    }
}
```
Add HW_DEFAULTS entry: `if (!HW_DEFAULTS.cubrecanto_ml) HW_DEFAULTS.cubrecanto_ml = { n: 'Cubrecanto PVC 0.45mm (por ml)', cost: 15 };`

Include cubrecantoCost in the module's total cost (add to matCostI or as separate line — follow the existing pattern of how extras costs are accumulated).
  </action>
  <verify>
Search for `moduleType === 'librero'` in assignHardware(). Confirm HW_DEFAULTS has regaton, pata_metalica, piston_150n, pata_niveladora, cubrecanto_ml. Check calc() door skip guard includes the 3 Tablered types. Check for isCubrecanto handling in calc().
  </verify>
  <done>
- assignHardware() returns fixed hardware for all 3 Tablered products (bisagras + product-specific hardware)
- HW_DEFAULTS has 5 new keys (regaton, pata_metalica, piston_150n, pata_niveladora, cubrecanto_ml) with guarded conditionals
- calc() door block skips all 3 Tablered types (puertas already in calculateParts)
- Cubrecanto line items priced per ml (not sheet area) and included in module cost
  </done>
</task>

</tasks>

<verification>
1. Open the app in browser, select "Librero" as project type in Step 1
2. Add a Librero module — verify 9 labeled pieces (A-I) appear in despiece with 59.2ml cubrecanto
3. Verify hardware shows 8 bisagras + 6 regatones
4. Select "Credenza" project type, add Credenza TV module — verify 7 pieces (A-G), 49ml cubrecanto, 8 bisagras, 4 patas
5. Select "Mesa de Centro" project type, add Mesa de Centro module — verify 9 pieces in 2 blocks, cubrecanto (12ml KIRA + 9ml NERO), 2 bisagras, 1 piston, 4 patas
6. Verify no door auto-generation occurs for any Tablered product (no duplicate puertas)
7. Verify cubrecanto cost appears in module pricing
</verification>

<success_criteria>
- All 3 Tablered products generate exact-spec despiece matching INSTRUCTIVO Sections 8, 9, 10
- Piece labels (A-I) match official catalog nomenclature
- Hardware counts match INSTRUCTIVO bill of materials exactly
- Cubrecanto priced per ml, not per sheet area
- Module picker correctly filters: librero shows only Librero, credenza shows only Credenza TV, mesa_centro shows only Mesa de Centro
- No door block interference (puertas come from calculateParts, not calc() door block)
</success_criteria>

<output>
After completion, create `.planning/phases/06-tablered-arauco/06-01-SUMMARY.md`
</output>
