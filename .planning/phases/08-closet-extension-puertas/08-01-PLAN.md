---
phase: 08-closet-extension-puertas
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [CLOS-01, CLOS-02]

must_haves:
  truths:
    - "User can add a colgadorCorto module in a closet project and the despiece shows 2 bars (upper and lower) with 4 bridas"
    - "User can add a maletero module in a closet project and the despiece shows techo, piso, costados, and an open cavity"
    - "Adding any closet module with height >150cm shows an orange anti-vuelco warning in step2()"
    - "Existing closet modules (colgador, zapatero, esquinero, entrepa, modulo) still work unchanged"
    - "The entrepa module description explicitly references Torre de Entrepanos with cremallera 32mm system"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "colgadorCorto + maletero MODS entries, calculateParts branches, assignHardware branches, anti-vuelco warning, updated entrepa description"
      contains: "colgadorCorto"
  key_links:
    - from: "MODS.colgadorCorto"
      to: "calculateParts()"
      via: "moduleType === 'colgadorCorto' branch"
      pattern: "moduleType === 'colgadorCorto'"
    - from: "MODS.maletero"
      to: "calculateParts()"
      via: "moduleType === 'maletero' branch"
      pattern: "moduleType === 'maletero'"
    - from: "step2() module card rendering"
      to: "anti-vuelco warning div"
      via: "height > 150 check for closet forType modules"
      pattern: "anti.?vuelco"
---

<objective>
Add missing closet module types (colgadorCorto double-bar, maletero luggage shelf), update entrepa description to explicitly cover "Torre de Entrepanos" per INSTRUCTIVO 6.1, and add an anti-vuelco warning for tall closet modules.

Purpose: Complete the closet module catalog per INSTRUCTIVO_TECNICO.md Section 6, and add a safety warning for modules taller than 1,500mm that must be anchored to the wall.
Output: 2 new MODS entries, updated entrepa MODS description, 2 calculateParts() branches, 2 assignHardware() branches, anti-vuelco warning in step2().
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@INSTRUCTIVO_TECNICO.md (Section 6 — Closets y Vestidores)
</context>

<tasks>

<task type="auto">
  <name>Task 1: colgadorCorto + maletero MODS, calculateParts, assignHardware + update entrepa description for torre entrepanos coverage</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**1. Update the existing `entrepa` MODS entry** (around line ~3194) to explicitly reference "Torre de Entrepanos" and the 32mm cremallera system per INSTRUCTIVO Section 6.1. The existing `entrepa` module already generates the correct despiece (laterals + techo/piso + N adjustable shelves + fondo) — it IS the torre entrepanos. Only update the `n` and `d` fields:

```javascript
entrepa: {
    n: 'Torre Entrepanos',
    w: [30, 40, 50, 60, 70, 80, 90, 100],
    d: 'Torre de entrepanos regulables | Cremallera 32mm | Ropa doblada, sueteres',
    custom: 1,
    forType: ['closet'],
    cat: 'Modulos'
},
```

This satisfies CLOS-01's "torre entrepanos" requirement. The existing calculateParts `entrepa` branch (line ~4943) already generates the correct multi-shelf despiece with configurable shelf count — no code changes needed there.

**2. Add 2 new MODS entries** after the existing `entrepa` entry:

```javascript
colgadorCorto: {
    n: 'Colgador Corto (Doble)',
    w: [60, 70, 80, 90],
    d: 'Doble barra | Camisas arriba, pantalones abajo',
    forType: ['closet'],
    cat: 'Modulos'
},
maletero: {
    n: 'Maletero',
    w: [60, 80, 90, 100, 120],
    d: 'Repisa superior | Maletas y ropa de temporada | Alto: 30-50cm',
    forType: ['closet'],
    cat: 'Modulos'
},
```

**3. Add calculateParts() branch for colgadorCorto** (after the existing `colgador` branch, around line ~4918):

Per INSTRUCTIVO 6.1 "Colgador Corto (Doble barra)":
- 2 barras superpuestas (double hanging)
- Alto libre por seccion: 600-650mm each
- Total alto: 1,300-1,400mm
- Barra superior at ~1,600mm from floor, inferior at ~900mm

Despiece:
```javascript
} else if (moduleType === 'colgadorCorto') {
    // Closet double-bar hanging module (INSTRUCTIVO 6.1)
    // AUDIT: Lateral — full depth, full height (outer structural panels)
    pieces.push({ n: 'Lateral',   q: 2, w: d,       h: h,             t: TK, z: 'i' });
    // AUDIT: Techo/Piso — w - 2*TK (= w - 32 at 16mm), fits between laterales
    pieces.push({ n: 'Techo/Piso', q: 2, w: w - 32, h: d,             t: TK, z: 'i' });
    // AUDIT: Entrepano — divider shelf between upper and lower hanging zones (at mid-height)
    pieces.push({ n: 'Entrepano', q: 1, w: w - 32, h: d,             t: TK, z: 'i' });
    // AUDIT: Fondo — inset by TK on all sides (w - 2*TK, h - 2*TK)
    pieces.push({ n: 'Fondo',     q: 1, w: w - 2 * TK, h: h - 2 * TK, t: TK, z: 'i' });
}
```

**4. Add calculateParts() branch for maletero** (after colgadorCorto):

Per INSTRUCTIVO 6.1 "Maletero":
- Repisa continua in upper part of closet
- Alto: 300-500mm
- Simple open shelf — costados + piso + techo + fondo, NO entrepaño, NO doors

```javascript
} else if (moduleType === 'maletero') {
    // Closet top luggage shelf module (INSTRUCTIVO 6.1)
    // AUDIT: Lateral — full depth, full height
    pieces.push({ n: 'Lateral',   q: 2, w: d,       h: h,             t: TK, z: 'i' });
    // AUDIT: Techo/Piso — w - 2*TK, fits between laterales
    pieces.push({ n: 'Techo/Piso', q: 2, w: w - 32, h: d,             t: TK, z: 'i' });
    // AUDIT: Fondo — inset by TK on all sides
    pieces.push({ n: 'Fondo',     q: 1, w: w - 2 * TK, h: h - 2 * TK, t: TK, z: 'i' });
    // Note: No entrepaño — single open cavity for luggage/seasonal storage
}
```

**5. Add assignHardware() branch for colgadorCorto** (after existing `colgador` branch, around line ~5486):

```javascript
} else if (moduleType === 'colgadorCorto') {
    // Closet double-bar hanging module — 2 tubes + 4 brackets
    // AUDIT: 2 tubes (upper + lower bar), 2 soportes per tube
    hw.push({ key: 'tubo',    q: 2 });
    hw.push({ key: 'soporte', q: 4 });
}
```

**6. Add assignHardware() branch for maletero** (after colgadorCorto):

```javascript
} else if (moduleType === 'maletero') {
    // Closet luggage shelf — no hardware (open shelf, no doors, no bars)
    // AUDIT: Maletero is a simple open box — no special hardware
}
```

Note: maletero needs no hardware — it's an open shelf module. The empty branch documents intent.

**7. Ensure existing closet modules are NOT modified.** Do not touch the colgador, zapatero, esquinero, or modulo branches. Only ADD new code and update the entrepa description fields.
  </action>
  <verify>
Open cotizador-template.html in browser. Create a closet project. Verify:
1. Module picker shows "Torre Entrepanos" (renamed from "Entrepaneras"), "Colgador Corto (Doble)", and "Maletero" buttons
2. Add a Torre Entrepanos module — despiece shows Lateral x2, Techo/Piso x2, Entrepano xN, Fondo x1 (same as before, just renamed)
3. Add colgadorCorto 80cm wide, 140cm tall, 55cm deep — despiece shows Lateral x2, Techo/Piso x2, Entrepano x1, Fondo x1
4. Add maletero 90cm wide, 40cm tall, 55cm deep — despiece shows Lateral x2, Techo/Piso x2, Fondo x1 (NO entrepano)
5. Existing colgador still works with 1 tube + 2 soportes
  </verify>
  <done>colgadorCorto and maletero available as closet modules with correct despiece and hardware; entrepa renamed to Torre Entrepanos with cremallera 32mm description; no regressions on existing closet modules</done>
</task>

<task type="auto">
  <name>Task 2: Anti-vuelco warning for closet modules > 1,500mm</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add an anti-vuelco (tip-over) warning in the step2() module card rendering section (around line ~7928, after the MDF-RH warning block and before the non-standard width warning).

The warning fires when:
- Module type has `forType` containing `'closet'` (check via `MODS[m.type] && MODS[m.type].forType && MODS[m.type].forType.indexOf('closet') !== -1`)
- Module height > 150 (cm, since m.height is in cm in the custom mode UI)

Use the same warning pattern as MDF-RH but with ORANGE/yellow color (like the non-standard width warning):

```javascript
// Anti-vuelco warning for tall closet modules (>1,500mm = 150cm)
if (MODS[m.type] && MODS[m.type].forType && MODS[m.type].forType.indexOf('closet') !== -1 && m.height > 150) {
    h += '<div style="background:rgba(250,204,21,0.15);border:1px solid rgba(250,204,21,0.4);border-radius:6px;padding:6px 10px;margin:4px 0;font-size:12px;color:#facc15">\u26a0 Anti-vuelco: modulo > 1,500mm de alto. Anclar a pared con taquetes obligatorio.</div>';
}
```

Insert this AFTER the MDF-RH check block (line ~7928) and BEFORE the non-standard width check (line ~7929).

Note: The warning is informational (orange, not red) because it doesn't block — it reminds the installer to anchor to the wall per INSTRUCTIVO 12.2 tip: "Muebles altos a la pared — anclar siempre con taquetes. Anti-vuelco obligatorio en muebles de mas de 1,500mm."
  </action>
  <verify>
Open browser. Create closet project.
1. Add a colgador module at 240cm height — orange anti-vuelco warning appears
2. Add a maletero module at 40cm height — NO anti-vuelco warning
3. Add an entrepa module at 160cm height — anti-vuelco warning appears
4. Verify MDF-RH warning still works on bano modules (no regression)
  </verify>
  <done>Anti-vuelco warning shows on any closet module taller than 150cm; no warning on short modules; no regressions on other warnings</done>
</task>

</tasks>

<verification>
1. Create a closet project and verify all closet modules are available: modulo, colgador, colgadorCorto, zapatero, esquinero, Torre Entrepanos (renamed entrepa), maletero
2. Torre Entrepanos description mentions "cremallera 32mm" and generates same despiece as before
3. Each new module generates correct despiece with AUDIT comments
4. Anti-vuelco warning appears on tall closet modules (>150cm), not on short ones
5. No regressions: existing closet, cocina, bano, tv modules still function correctly
</verification>

<success_criteria>
- colgadorCorto generates despiece with 2 tubes, 4 soportes in hardware
- maletero generates open-shelf despiece with no hardware
- entrepa (Torre Entrepanos) description updated to reference cremallera 32mm system per INSTRUCTIVO 6.1
- Anti-vuelco warning visible on modules >150cm height in closet project type
- All existing closet modules unchanged (entrepa only renamed, logic untouched)
</success_criteria>

<output>
After completion, create `.planning/phases/08-closet-extension-puertas/08-01-SUMMARY.md`
</output>
