---
phase: 10-quality-polish
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [QUAL-03, QUAL-04]

must_haves:
  truths:
    - "Hovering over any module type button in step2() shows a tooltip with standard dimensions and description"
    - "The sheet optimizer shows the number of 1220x2440mm sheets needed from the full despiece piece list"
    - "Tooltips disappear when the mouse leaves the button"
    - "Sheet count updates automatically when calc() runs"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "Tooltip CSS + hover logic on add-btn buttons, sheet optimizer function"
      contains: "tooltip"
    - path: "cotizador-template/cotizador-template.html"
      provides: "calcSheets function that computes sheet count from piece list"
      contains: "calcSheets"
  key_links:
    - from: "step2() add-btn buttons"
      to: "MODS[mk].d and MODS[mk].w"
      via: "title attribute or custom tooltip div"
      pattern: "MODS\\[mk\\]"
    - from: "calcSheets()"
      to: "calc() pieces array"
      via: "iterates c.pieces to sum area"
      pattern: "calcSheets"
---

<objective>
Add module type tooltips and a sheet optimization calculator to the cotizador.

Purpose: Improve usability by showing what each module does before adding it, and help the carpenter know how many standard sheets to purchase.
Output: Tooltips on all module add buttons; sheet count displayed in step3() cost summary.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@CONTEXT.md
@cotizador-template/cotizador-template.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tooltips to module type buttons in step2()</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add CSS-only tooltips to the module add-btn buttons rendered in step2(). For each button in the `groups[gName].forEach` loop (around line 8310-8312), change the button HTML to include a `title` attribute composed from MODS[mk] data:

Format: `title="MODS[mk].d + ' | Anchos: ' + MODS[mk].w.join(', ') + 'cm'"`

This provides the standard dimensions (from the `w` array) and the description (from the `d` field) on hover using the browser's native title tooltip. No custom CSS tooltip div needed -- the native title attribute is sufficient and works on all browsers.

The existing button line at ~line 8311:
```javascript
h += '<button class="add-btn" onclick="APP.addMod(\'' + mk + '\')">' + svg('plus') + MODS[mk].n + '</button>';
```

Change to:
```javascript
var tip = (MODS[mk].d || '') + (MODS[mk].w ? ' | Anchos: ' + MODS[mk].w.join(', ') + 'cm' : '');
h += '<button class="add-btn" title="' + tip + '" onclick="APP.addMod(\'' + mk + '\')">' + svg('plus') + MODS[mk].n + '</button>';
```

This is the simplest approach that satisfies the requirement without adding CSS complexity. The native tooltip shows on hover and disappears on mouse leave automatically.
  </action>
  <verify>Open the HTML file in a browser, select any project type (e.g., Cocina), hover over a module button (e.g., "Bajo Estandar"). A native tooltip should appear showing the description and available widths (e.g., "1-2 puertas automaticas | Anchos: 30, 40, 50, 60, 70, 80, 90, 100cm"). Verify tooltips appear for closet, cocina, bano, and TV module buttons.</verify>
  <done>Every module add-btn button in step2() has a title attribute showing MODS[mk].d and MODS[mk].w values. Tooltip appears on hover, disappears on mouse leave.</done>
</task>

<task type="auto">
  <name>Task 2: Add sheet optimization calculator</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Create a `calcSheets(pieces)` function that calculates the number of standard 1220x2440mm melamina sheets needed from the despiece piece list. Place the function near the other calc helper functions (near calc() or after it).

**Algorithm:**
1. Accept the pieces array from calc() (c.pieces). Each piece has: `n` (name), `w` (width mm), `h` (height mm), `q` (quantity), `z` (zone: 'c' for casco, 'f' for frente), `tk` (thickness).
2. Filter pieces to only those with tk === 15 (standard melamina sheets -- exclude HDF 3mm fondo pieces and cubierta pieces which have isCubierta flag).
3. Sum total area: for each piece, area += (p.w * p.h * p.q). Apply CONFIG.pricing.mermaFactor (1.20, i.e., 20% waste).
4. Sheet area = 1220 * 2440 = 2,976,800 mm^2.
5. Sheets needed = Math.ceil(totalAreaWithMerma / sheetArea).
6. Optionally split by zone: casco sheets (z === 'c') and frente sheets (z === 'f').
7. Return `{ casco: N, frente: M, total: N+M }`.

```javascript
function calcSheets(pieces) {
    var SHEET_W = 1220, SHEET_H = 2440;
    var sheetArea = SHEET_W * SHEET_H;
    var merma = CONFIG.pricing.mermaFactor || 1.20;
    var cascoArea = 0, frenteArea = 0;
    (pieces || []).forEach(function(p) {
        if (p.tk !== 15 && p.tk !== 18) return; // only standard sheets
        if (p.isCubierta) return; // cubierta priced separately
        var a = p.w * p.h * (p.q || 1);
        if (p.z === 'f') frenteArea += a;
        else cascoArea += a;
    });
    return {
        casco: Math.ceil((cascoArea * merma) / sheetArea),
        frente: Math.ceil((frenteArea * merma) / sheetArea),
        total: Math.ceil((cascoArea * merma) / sheetArea) + Math.ceil((frenteArea * merma) / sheetArea)
    };
}
```

**Display in step3():** Find the step3() function (around line 6763+). After the cost summary section, add a "Laminas Necesarias" info box. Locate where step3() builds the summary HTML and add after the totals display:

```javascript
var sheets = calcSheets(c.pieces);
if (sheets.total > 0) {
    h += '<div style="margin-top:12px;padding:12px;background:#1a2a1a;border:1px solid #2a4a2a;border-radius:8px">';
    h += '<div style="font-size:13px;color:#4a9;font-weight:600;margin-bottom:6px">Laminas Necesarias (1220x2440mm, +20% merma)</div>';
    h += '<div style="display:flex;gap:16px;font-size:13px;color:#ccc">';
    h += '<span>Casco: <strong>' + sheets.casco + '</strong></span>';
    h += '<span>Frente: <strong>' + sheets.frente + '</strong></span>';
    h += '<span style="color:#4a9">Total: <strong>' + sheets.total + '</strong> laminas</span>';
    h += '</div></div>';
}
```

Find the exact insertion point by searching for the totals section in step3(). The sheet info box should appear after the final total line and before the PDF buttons section.
  </action>
  <verify>Open the HTML file, create a cocina project, add 2-3 bajo modules (e.g., bajoEstandar 60cm, cajonera 60cm). Navigate to step 3 (summary). Verify a green-bordered "Laminas Necesarias" box appears below the cost totals showing Casco: N, Frente: M, Total: N+M sheets. The numbers should be reasonable (e.g., 2-4 sheets for a small cocina). Verify that a project with no modules shows no sheet box (total = 0).</verify>
  <done>calcSheets() function exists and correctly computes sheet counts from piece list. step3() displays the sheet count box with casco/frente/total breakdown. Zero-module projects show no box.</done>
</task>

</tasks>

<verification>
- Hover over any add-btn button in step2() and see tooltip with description + widths
- step3() shows "Laminas Necesarias" box with sheet counts after adding modules
- Both features work for all project types (closet, cocina, bano, tv, etc.)
- No regressions: existing calc(), step2(), step3(), genClientPDF(), genInternalPDF() still work
</verification>

<success_criteria>
- All module add buttons show tooltips on hover with MODS description and standard widths
- Sheet optimizer correctly calculates sheets needed with 20% merma factor
- Sheet count displayed in step3() with casco/frente breakdown
</success_criteria>

<output>
After completion, create `.planning/phases/10-quality-polish/10-01-SUMMARY.md`
</output>
