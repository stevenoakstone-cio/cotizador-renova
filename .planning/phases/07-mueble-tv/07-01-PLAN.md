---
phase: 07-mueble-tv
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [MTV-01, MTV-02, MTV-03, MTV-04]
must_haves:
  truths:
    - "consolaPatas and consolaFlotante MODS entries exist with forType:['tv'] and distinct module types"
    - "torreLateralTV MODS entry exists with forType:['tv'] and 300-500mm width range"
    - "repisaFlotante MODS entry exists with forType:['tv'] supporting hollow-box and hidden-bracket variants"
    - "panelFondo MODS entry exists with forType:['tv'] for lambrin with bastidor"
    - "calculateParts() returns correct despiece for all 5 TV module types"
    - "assignHardware() returns correct hardware for all 5 TV module types"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "MODS entries, calculateParts branches, assignHardware branches, HW_DEFAULTS keys for TV modules"
      contains: "moduleType === 'consolaPatas'"
  key_links:
    - from: "MODS entries"
      to: "calculateParts()"
      via: "moduleType string matching"
      pattern: "moduleType === '(consolaPatas|consolaFlotante|torreLateralTV|repisaFlotante|panelFondo)'"
    - from: "MODS entries"
      to: "assignHardware()"
      via: "moduleType string matching"
      pattern: "moduleType === '(consolaPatas|consolaFlotante|torreLateralTV|repisaFlotante|panelFondo)'"
---

<objective>
Add 5 MODS entries for TV unit module types (consolaPatas, consolaFlotante, torreLateralTV, repisaFlotante, panelFondo), their calculateParts() despiece branches, assignHardware() hardware branches, and required HW_DEFAULTS keys.

Purpose: Data layer for all TV module types so that step2() can display them and calc() can price them.
Output: 5 MODS entries with forType:['tv'], calculateParts() and assignHardware() branches for all 5 module types, new HW_DEFAULTS keys.
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-banos/05-01-SUMMARY.md
@.planning/phases/06-tablered-arauco/06-01-SUMMARY.md
@cotizador-template/cotizador-template.html
@INSTRUCTIVO_TECNICO.md (Section 5: Muebles de TV)
</context>

<tasks>

<task type="auto">
  <name>Task 1: MODS entries + HW_DEFAULTS + calculateParts() for 5 TV module types</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add 5 MODS entries in the MODS array (after existing entries, grouped together) with `forType: ['tv']` and `cat: 'TV'`:

1. **consolaPatas** — Consola con Patas
   - w: [120, 150, 180, 200, 240] (typical consola widths in cm)
   - h default: 40cm (casco body height), d default: 40cm
   - cat: 'TV', forType: ['tv']

2. **consolaFlotante** — Consola Flotante
   - w: [120, 150, 180, 200, 240]
   - h default: 40cm, d default: 40cm
   - cat: 'TV', forType: ['tv']

3. **torreLateralTV** — Torre Lateral TV
   - w: [30, 35, 40, 45, 50] (300-500mm per INSTRUCTIVO 5.1)
   - h default: 180cm, d default: 30cm (250-350mm per spec)
   - cat: 'TV', forType: ['tv']

4. **repisaFlotante** — Repisa Flotante
   - w: [60, 80, 100, 120, 150]
   - h default: 4cm (single shelf thickness — 38-40mm for hidden bracket, or box height), d default: 25cm
   - cat: 'TV', forType: ['tv']

5. **panelFondo** — Panel de Fondo (Lambrin)
   - w: [120, 150, 180, 200, 240]
   - h default: 180cm, d default: 3cm (panel + bastidor gap ~20-30mm)
   - cat: 'TV', forType: ['tv']

Add HW_DEFAULTS guarded conditionals (same pattern as existing keys: `if (!HW_DEFAULTS.key) HW_DEFAULTS.key = price;`):
- `soporte_flotante` — $45 DEMO (hidden wall bracket for flotante consola/repisa)
- `herraje_repisa` — $120 DEMO (hidden bracket/espigon hardware for repisas, per pair)
- `bastidor_ml` — $25 DEMO (pine bastidor frame per linear meter for panel de fondo)

Add calculateParts() branches for all 5 types:

**consolaPatas** — Standard casco despiece (follows bajo pattern but shorter/shallower):
- costado x2: h x d
- piso x1: (w - 2*TK) x d
- techo x1: (w - 2*TK) x d
- fondo HDF x1: (w - 2*TK) x h, thickness: 3
- amarre frontal x1: (w - 2*TK) x 80 // AUDIT: structural rigidity
- entrepaño x1: (w - 2*TK - 2*TK) x (d - TK) // AUDIT: inner shelf with 15mm holgura each side
- Puertas generated by calc() door block (NOT here) — do NOT add isPuerta pieces

**consolaFlotante** — Same casco as consolaPatas (identical pieces), mounting is soporte_flotante not patas:
- Same pieces as consolaPatas (costado, piso, techo, fondo, amarre, entrepaño)
- No puertas here — calc() door block handles them

**torreLateralTV** — Vertical tower, open niches or with door:
- costado x2: h x d
- piso x1: (w - 2*TK) x d
- techo x1: (w - 2*TK) x d
- fondo HDF x1: (w - 2*TK) x h, thickness: 3
- entrepaño x2: (w - 2*TK) x (d - TK) // AUDIT: 2 shelves dividing into 3 sections

**repisaFlotante** — Depends on m.variant ('hueca' or 'herraje'):
- If variant === 'hueca' (hollow box):
  - tapa_superior x1: w x d
  - tapa_inferior x1: w x d
  - costado_caja x2: (h - 2*TK) x d — the box sides
  - fondo x1: (w - 2*TK) x d, thickness: 3 // HDF backing to hide wall mount

- If variant === 'herraje' (hidden bracket):
  - tablero_repisa x1: w x d // Single solid shelf, at least 38mm thick
  - Note: The h parameter should be forced to at least 38mm for this variant. Add comment: // AUDIT: min 38mm for herraje oculto insertion

**panelFondo** — Lambrin panel with hidden bastidor:
- panel x1: w x h // Main visible panel, material: frente (premium)
- bastidor_horizontal x2: (w - 100) x 50, material: 'bastidor' // AUDIT: pine frame top+bottom, 50mm from edges
- bastidor_vertical x2: (h - 100) x 50, material: 'bastidor' // AUDIT: pine frame left+right
- bastidor_travesano x1: (w - 100) x 50, material: 'bastidor' // AUDIT: center cross-brace
- All bastidor pieces get `isBastidor: true` flag (priced per linear meter like cubrecanto, excluded from sheet area)

For bastidor pricing in calc(): bastidor pieces have `isBastidor: true` — accumulate total linear meters of bastidor, price via HW_DEFAULTS.bastidor_ml. Add bastidorCost to extraCost bucket (parallel to cubrecantoCost pattern from Phase 6).
  </action>
  <verify>
Search for all 5 moduleType branches in calculateParts():
- grep for `moduleType === 'consolaPatas'` — found in calculateParts
- grep for `moduleType === 'consolaFlotante'` — found in calculateParts
- grep for `moduleType === 'torreLateralTV'` — found in calculateParts
- grep for `moduleType === 'repisaFlotante'` — found in calculateParts
- grep for `moduleType === 'panelFondo'` — found in calculateParts
- grep for `forType.*tv` — 5 MODS entries
- grep for `soporte_flotante` in HW_DEFAULTS
- grep for `herraje_repisa` in HW_DEFAULTS
- grep for `bastidor_ml` in HW_DEFAULTS
  </verify>
  <done>5 MODS entries with forType:['tv'], 5 calculateParts() branches producing correct despiece arrays per INSTRUCTIVO Section 5, 3 new HW_DEFAULTS keys with guarded conditionals</done>
</task>

<task type="auto">
  <name>Task 2: assignHardware() for 5 TV module types</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
Add assignHardware() branches for all 5 TV module types (same pattern as existing bano/cocina branches):

**consolaPatas:**
- pata x4 (same key as cocina bajos)
- zoclo_clip x4 (same key as cocina bajos)
- Note: bisagras handled by calc() door block, NOT here

**consolaFlotante:**
- soporte_flotante x2 (wall-mount brackets, parallel to soporte_bano pattern)
- Note: bisagras handled by calc() door block

**torreLateralTV:**
- pata x4 (floor-standing tower, same pattern as cocina torres)
- Note: bisagras for door option handled by calc() door block

**repisaFlotante:**
- If variant === 'hueca': soporte_flotante x2 (internal brackets hidden inside box)
- If variant === 'herraje': herraje_repisa x1 (pair of hidden espigon brackets)
- No bisagras, no jaladeras (open shelf)

**panelFondo:**
- No standard hardware — the bastidor is already in calculateParts as bastidor pieces
- The panel attaches to bastidor with tornillos (not tracked as separate hardware — absorbed in carpentry cost)
- Push nothing to hardware array (or just return empty — pattern: no explicit hardware needed)

Wire the assignHardware calls: follow same `else if (moduleType === 'xxx')` chain pattern as existing modules. Group all 5 TV types together with a `// --- TV modules ---` comment.
  </action>
  <verify>
Search for all 5 moduleType branches in assignHardware():
- grep for `moduleType === 'consolaPatas'` — found in assignHardware
- grep for `moduleType === 'consolaFlotante'` — found in assignHardware
- grep for `moduleType === 'torreLateralTV'` — found in assignHardware
- grep for `moduleType === 'repisaFlotante'` — found in assignHardware
- grep for `moduleType === 'panelFondo'` — found in assignHardware
  </verify>
  <done>assignHardware() returns correct hardware list for all 5 TV module types: consolaPatas gets pata+zoclo_clip, consolaFlotante gets soporte_flotante, torreLateralTV gets pata, repisaFlotante gets soporte_flotante or herraje_repisa by variant, panelFondo gets no hardware</done>
</task>

</tasks>

<verification>
- All 5 MODS entries found with `forType: ['tv']`
- All 5 calculateParts() branches present with correct despiece formulas
- All 5 assignHardware() branches present with correct hardware assignments
- 3 new HW_DEFAULTS keys present (soporte_flotante, herraje_repisa, bastidor_ml)
- isBastidor pricing pattern integrated into calc() area loop (parallel to isCubrecanto)
- No existing closet/cocina/bano functionality broken
</verification>

<success_criteria>
- 5 new module types registered in MODS with forType:['tv']
- calculateParts() generates correct piece arrays for consolaPatas, consolaFlotante, torreLateralTV, repisaFlotante (both variants), panelFondo
- assignHardware() assigns correct hardware per module type
- bastidorCost flows through calc() extraCost bucket like cubrecantoCost
</success_criteria>

<output>
After completion, create `.planning/phases/07-mueble-tv/07-01-SUMMARY.md`
</output>
