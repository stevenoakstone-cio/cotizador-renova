---
phase: 09-multi-tenant-saas
plan: "02"
type: execute
wave: 2
depends_on: [09-01]
files_modified:
  - cotizador-template/cotizador-template.html
autonomous: true
requirements: [MTNT-02, MTNT-03]

must_haves:
  truths:
    - "genClientPDF() uses APP_CONFIG company name and logo instead of hardcoded Renova"
    - "genInternalPDF() uses APP_CONFIG company name and logo instead of hardcoded Renova"
    - "The app header shows a green dot when connected to Supabase and a red dot when offline or no Supabase"
    - "Connection indicator updates in real-time after initial cloud fetch completes"
  artifacts:
    - path: "cotizador-template/cotizador-template.html"
      provides: "Branded PDFs via APP_CONFIG, connection status indicator in header"
      contains: "connection-indicator"
  key_links:
    - from: "genClientPDF()"
      to: "CONFIG.brand / S.logoBase64"
      via: "br.name from BRANDS which reads CONFIG.brand (already overridden by APP_CONFIG)"
      pattern: "br\\.name"
    - from: "connection indicator"
      to: "sb variable and cloudProjects"
      via: "DOM element with class/id for status dot"
      pattern: "connection-indicator|cloud-status"
---

<objective>
Wire APP_CONFIG branding into PDF generation and add a Supabase connection status indicator to the app header.

Purpose: PDFs must show the tenant's company name and logo (not Renova), and users need visual feedback on whether their cloud connection is active.
Output: Branded PDFs + connection status dot in header
</objective>

<execution_context>
@C:/Users/Steven PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Steven PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-multi-tenant-saas/09-01-SUMMARY.md
@cotizador-template/cotizador-template.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify PDF branding uses CONFIG.brand (already dynamic) and add connection indicator</name>
  <files>cotizador-template/cotizador-template.html</files>
  <action>
**PDF Branding (MTNT-02):**

The existing PDF code already reads from `BRANDS[S.brand]` which is built from `CONFIG.brand`. Since Plan 09-01 overrides `CONFIG.brand` at boot from APP_CONFIG, the PDFs should already work. However, verify and fix any remaining hardcoded "Renova" strings in both PDF functions:

1. In genClientPDF() (~line 8984), check that:
   - Title bar uses `br.name` (not hardcoded "RENOVA") — it already does at line 9010/9012
   - Logo uses `S.logoBase64` (already does at line 9008-9009)
   - Contact info uses `S.contactInfo` fields (already does)
   - Legal terms use `CONFIG.brand.legalTerms` (already does at line 9140)
   - Search for any remaining literal "Renova" or "RN" strings in both PDF functions and replace with CONFIG.brand references

2. In genInternalPDF() (~line 9528), do the same check:
   - Header should use `br.name` not hardcoded text
   - Search for hardcoded brand references

3. Also check the estandarizado PDF path (~line 13784) where `genClientPDF(S.estProject, calcEstandarizado())` is called — this should also use the dynamic brand since it calls the same function.

4. Check `document.title` at ~line 13798 — already uses `CONFIG.brand.name`, should work.

**Connection Indicator (MTNT-03):**

1. Find the app header/toolbar area in the HTML. Look for the top bar that shows the brand name or navigation. Add a small status indicator dot.

2. Add a `<span>` element with id "cloud-status" in the header area:
   - Style: 8px circle (width/height 8px, border-radius 50%), inline-block, margin-left 8px, vertical-align middle
   - Default state: gray (#666) with title "Sin conexion cloud"
   - Connected state: green (#4caf50) with title "Conectado a Supabase"
   - Disconnected/error state: red (#f44336) with title "Error de conexion"

3. Create a function `updateCloudStatus(status)` where status is 'connected', 'disconnected', or 'none':
   - 'connected': green dot, title "Conectado a Supabase"
   - 'disconnected': red dot, title "Error de conexion"
   - 'none': gray dot, title "Sin conexion cloud" (no Supabase configured)

4. Call `updateCloudStatus('none')` at init if CONFIG.supabase.url is empty.

5. In the existing `cloudFetchProjects()` function (or wherever the initial Supabase fetch happens), add:
   - On success: `updateCloudStatus('connected')`
   - On error/catch: `updateCloudStatus('disconnected')`

6. If `sb` is null (no Supabase client created), set status to 'none'.

7. The indicator should be visible at all times in the header, providing constant feedback.
  </action>
  <verify>
1. Set up APP_CONFIG with a custom company name (e.g., "Mi Taller")
2. Generate a Client PDF — it should say "MI TALLER" in the header, not "RENOVA"
3. Generate an Internal PDF — same check
4. With no Supabase URL configured: gray dot visible in header
5. With a valid Supabase URL: green dot after successful connection
6. With an invalid Supabase URL: red dot after failed connection attempt
  </verify>
  <done>PDFs show the configured company name and logo from APP_CONFIG; header shows green/red/gray connection status indicator</done>
</task>

</tasks>

<verification>
1. Configure APP_CONFIG with custom company name and logo
2. Export Client PDF — branding matches APP_CONFIG
3. Export Internal PDF — branding matches APP_CONFIG
4. Connection dot reflects actual Supabase status (green/red/gray)
</verification>

<success_criteria>
- No hardcoded "Renova" appears in generated PDFs when APP_CONFIG has a different company name
- Connection indicator is always visible in the header
- Indicator correctly reflects Supabase connection state
</success_criteria>

<output>
After completion, create `.planning/phases/09-multi-tenant-saas/09-02-SUMMARY.md`
</output>
